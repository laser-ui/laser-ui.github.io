import{u as ue,l as h,r as P,f as w,j as q}from"./index-c7f928aa.js";import{c as he}from"./Route-eb85ed30.js";const x=Symbol();function pe(se){const{ref:le,children:ne,enable:k=!0,list:M,listSize:G,listPadding:A,itemKey:U,itemRender:D,itemSize:C,itemEmptySize:H=0,itemNested:a,itemEmptyRender:L,itemExpand:I,itemFocusable:V=!0,itemFocused:W,itemInAriaSetsize:B=!0,placeholder:R,horizontal:z=!1,onScrollEnd:J}=ue("VirtualScroll",se),d=h.isNumber(A)?[A,A]:A,_=P.useRef(new Map),[oe,re]=P.useState(0),v=P.useMemo(()=>h.isNumber(C)?()=>C:C,[C]),N=P.useMemo(()=>h.isNumber(H)?()=>H:H,[H]),F=P.useMemo(()=>h.isBoolean(V)?()=>V:V,[V]),X=P.useMemo(()=>h.isBoolean(B)?()=>B:B,[B]),[K,ce,ae,fe]=P.useMemo(()=>{const l=new Map;let c=0,t=0,o,S;if(k){const r=(n,s=0)=>{let e=0;for(const i of n){F(i)&&(S=i,h.isUndefined(o)&&(o=i));const u=U(i),f=v(i);e+=f,c+=f;const g={item:i,level:s,accSize:c,nestedSize:0};l.set(u,g);const p=a==null?void 0:a(i);p&&(!I||I(i))&&(p.length===0?(g.nestedSize=N(i),e+=g.nestedSize,c+=g.nestedSize):(g.nestedSize=r(p,s+1),e+=g.nestedSize))}return e};t=r(M)}else{const r=(n,s=0)=>{for(const e of n){F(e)&&(S=e,h.isUndefined(o)&&(o=e));const i=U(e),u={item:e,level:s,accSize:c,nestedSize:0};l.set(i,u);const f=a==null?void 0:a(e);f&&(!I||I(e))&&f.length>0&&r(f,s+1)}};r(M)}return[l,t,o,S]},[k,N,I,F,U,a,v,M]),de=(()=>{if(k){const l=Math.max(ce+d[0]+d[1]-G,0),c=Math.min(oe,l);let t=0;const o=c-G-d[0],S=c+G*2-d[0];let r=!1,n=!1;const s=(e,i=[])=>{const u=[0,0],f=[],g=e.filter(p=>p===x?!1:X(p)).length;for(const[p,m]of e.entries()){let T=0,$=0,Y,E,O;if(m===x?a!=null&&a(i[i.length-1])&&(T=N(i[i.length-1]),O=q.jsx(P.Fragment,{children:L==null?void 0:L(i[i.length-1])},"$$empty")):(Y=U(m),T=v(m),E=a==null?void 0:a(m),E&&($=K.get(Y).nestedSize)),n){u[1]+=T+$;continue}if(t+=T,E)if(t+$>o){const Q=I?I(m):void 0;let j=[];h.isUndefined(Q)?j=s(E.length===0?[x]:E,i.concat([m])):(j=_.current.get(Y)??[],Q&&(j=s(E.length===0?[x]:E,i.concat([m])),_.current.set(Y,j))),f.push(D(m,p,{"aria-level":i.length+1,"aria-setsize":g,"aria-posinset":p+1},i,j))}else t+=$,u[0]+=T+$;else r?n||(t>S?(n=!0,u[1]+=T):f.push(m===x?O:D(m,p,{"aria-level":i.length+1,"aria-setsize":g,"aria-posinset":p+1},i))):t>o?(f.push(m===x?O:D(m,p,{"aria-level":i.length+1,"aria-setsize":g,"aria-posinset":p+1},i)),r=!0):u[0]+=T}return u[0]>0&&f.unshift(q.jsx(R,{style:{display:z?"inline-block":"block",overflow:"hidden",width:z?u[0]:0,height:z?0:u[0],flexShrink:0},"aria-hidden":!0},"$$fill-size-0")),u[1]>0&&f.push(q.jsx(R,{style:{display:z?"inline-block":"block",overflow:"hidden",width:z?u[1]:0,height:z?0:u[1],flexShrink:0},"aria-hidden":!0},"$$fill-size-1")),f};return s(M)}else{const l=(c,t=[])=>{const o=[],S=c.filter(r=>r===x?!1:X(r)).length;for(const[r,n]of c.entries()){let s,e,i;if(n===x?a!=null&&a(t[t.length-1])&&(i=q.jsx(P.Fragment,{children:L==null?void 0:L(t[t.length-1])},"$$empty")):(s=U(n),e=a==null?void 0:a(n)),e){const u=I?I(n):void 0;let f=[];h.isUndefined(u)?f=l(e.length===0?[x]:e,t.concat([n])):(f=_.current.get(s)??[],u&&(f=l(e.length===0?[x]:e,t.concat([n])),_.current.set(s,f))),o.push(D(n,r,{"aria-level":t.length+1,"aria-setsize":S,"aria-posinset":r+1},t,f))}else o.push(n===x?i:D(n,r,{"aria-level":t.length+1,"aria-setsize":S,"aria-posinset":r+1},t))}return o};return l(M)}})(),b=(l,c)=>{l[z?"scrollLeft":"scrollTop"]=c},Z=w((l,c)=>{const t=K.get(c);return k&&!h.isUndefined(t)&&b(l,t.accSize-v(t.item)+d[0]),t==null?void 0:t.item}),y=w(l=>(k&&b(l,0),ae)),ee=w(l=>(k&&b(l,l[z?"scrollWidth":"scrollHeight"]),fe)),te=w((l,c)=>{if(h.isUndefined(W))return;let t,o,S=-1,r=-1;const n=[];for(const s of K)S+=1,s[0]===W&&(r=S),n.push(s[1]);if(r!==-1)if(c===1)for(let s=r+1,e=0;e<n.length;s++,e++){const i=h.nth(n,s%n.length);if(i&&F(i.item)){t=i.item,k&&(o=[i.accSize-v(t)+d[0],i.accSize+d[0]]);break}}else for(let s=r-1,e=0;e<n.length;s--,e++){const i=h.nth(n,s);if(i&&F(i.item)){t=i.item,k&&(o=[i.accSize-v(t)+d[0],i.accSize+d[0]]);break}}if(!h.isUndefined(o)){const s=l[z?"scrollLeft":"scrollTop"],e=l[z?"clientWidth":"clientHeight"];s>o[1]?b(l,o[0]-d[0]):o[0]>s+e?b(l,o[1]-e+d[0]):c===1?o[1]>s+e&&b(l,o[1]-e+d[0]):s>o[0]&&b(l,o[0]-d[0])}return t}),ie=w(l=>{if(h.isUndefined(W))return;let c,t,o=-1,S=-1,r=0;const n=[];for(const s of K)o+=1,s[0]===W&&(S=o,r=s[1].level),n.push(s[1]);if(S!==-1)for(let s=S+1;s<n.length;s++){const e=n[s];if(e.level<=r)return;if(F(e.item)){c=e.item,k&&(t=[e.accSize-v(c)+d[0],e.accSize+d[0]]);break}}if(!h.isUndefined(t)){const s=l[z?"scrollLeft":"scrollTop"],e=l[z?"clientWidth":"clientHeight"];s>t[1]?b(l,t[0]-d[0]):(t[0]>s+e||t[1]>s+e)&&b(l,t[1]-e+d[0])}return c});return P.useImperativeHandle(le,()=>({scrollToItem:Z,scrollToStep:te,scrollToNested:ie,scrollToStart:y,scrollToEnd:ee}),[Z,te,ie,y,ee]),ne(de,l=>{re(l.currentTarget[z?"scrollLeft":"scrollTop"]),he(l.currentTarget)[z?"x":"y"]&&(J==null||J())})}export{pe as V};
