import{r as _,w as ye,n as je,e as Ce,Q as v,s as Me,j as n,I as Y,F as Ne,u as Pe,a as Be,b as He,x as Ie,d as ze,l as T,c as we,z as Ye,J as Fe,f as Le,K as Ue,h as $e,i as fe,g as Oe,N as Ke,m as he,P as We,k as Ge,O as Je,B as Qe,R as Ze,W as De}from"./index-2a8bb1b1.js";import{u as qe}from"./MdRoute-717d4287.js";import{s as Xe}from"./setRef-a734977e.js";import{S as et}from"./cancel-1cb71692.js";import{d as tt,S as rt,T as nt,o as ct}from"./utils-c7d5580e.js";import{S as at}from"./keyboard_arrow_left-bd361635.js";import{S as it,a as st}from"./keyboard_double_arrow_right-71d63832.js";import{B as ot}from"./BaseInput-aa999b55.js";const lt=W=>_.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",...W},_.createElement("path",{d:"M20 3h-1V1h-2v2H7V1H5v2H4c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 18H4V10h16v11zm0-13H4V5h16v3z"}));function dt(W){const{ref:de,styled:w,currentSelected:f,anotherSelected:m,config:G,range:ne,onDateChange:ue}=W,V=_.useRef({}),{t:H,lang:h}=ye(),F=je(),pe=Ce(()=>window),L=f?v(f):v().set("hour",0).set("minute",0).set("second",0),A=m?v(m):null,[_e,I]=_.useState(L.toDate()),U=v(_e),[k,ce]=_.useState(null),p=(o,a)=>{const l=()=>{I(d=>{const C=v(d);return C.set(o,C.get(o)+a).toDate()})};l();const i=()=>{l(),V.current.clearLoop=F.setTimeout(()=>i(),50)};V.current.clearTid=F.setTimeout(()=>i(),400)},ae=()=>{var o,a,l,i;(a=(o=V.current).clearLoop)==null||a.call(o),(i=(l=V.current).clearTid)==null||i.call(l)};Me(pe,"mouseup",ae),_.useImperativeHandle(de,()=>I,[]);const $=(o,a)=>({onMouseDown:l=>{l.button===0&&p(o,a)},onTouchStart:()=>{p(o,a)},onTouchEnd:()=>{ae()}}),J=(()=>{const o=U.set("date",1),a=[];let l=[];for(let i=0,d=-o.day();i<7*6;i++,d++)l.push(o.add(d,"day").toDate()),l.length===7&&(a.push(l),l=[]);return a})();return n.jsxs("div",{...w("date-picker__panel"),children:[n.jsxs("div",{...w("date-picker__header"),children:[n.jsx("button",{...w("date-picker__header-button"),...$("year",-1),title:H("DatePicker","Previous year"),children:n.jsx(Y,{children:n.jsx(it,{})})}),n.jsx("button",{...w("date-picker__header-button"),...$("month",-1),title:H("DatePicker","Previous month"),children:n.jsx(Y,{children:n.jsx(at,{})})}),n.jsx("span",{...w("date-picker__header-date"),children:U.format(h==="zh-CN"?"YYYY年 M月":"MMM YYYY")}),n.jsx("button",{...w("date-picker__header-button"),...$("month",1),title:H("DatePicker","Next month"),children:n.jsx(Y,{children:n.jsx(Ne,{})})}),n.jsx("button",{...w("date-picker__header-button"),...$("year",1),title:H("DatePicker","Next year"),children:n.jsx(Y,{children:n.jsx(st,{})})})]}),n.jsxs("table",{...w("date-picker__table"),children:[n.jsx("thead",{children:n.jsx("tr",{children:v.weekdaysMin().map(o=>n.jsx("th",{children:o},o))})}),n.jsx("tbody",{children:J.map((o,a)=>n.jsx("tr",{children:o.map((l,i)=>{const d=v(l),{disabled:C=!1}=(G==null?void 0:G(l))??{},M=f&&d.isSame(L,"date"),Q=A&&d.isSame(A,"date"),D=!M&&!Q&&A&&d.isSame(k,"date"),x=!M&&!M&&!D&&f&&A&&d.isBetween(L,A,"date"),N=!M&&k&&A&&d.isBetween(k,A,"date");return n.jsx("td",{style:{pointerEvents:C?"none":void 0},onClick:()=>{I(l),ue(L.set("year",d.year()).set("month",d.month()).set("date",d.date()).toDate())},onMouseEnter:()=>{var b,g;(g=(b=V.current).clearHoverTid)==null||g.call(b),ce(l)},onMouseLeave:()=>{var b,g;(g=(b=V.current).clearHoverTid)==null||g.call(b),V.current.clearHoverTid=F.setTimeout(()=>ce(null),50)},children:n.jsx("div",{...w("date-picker__cell",{"date-picker__cell.is-active":ne?Q:M,"date-picker__cell.is-hover":D||ne&&M,"date-picker__cell.is-between":x,"date-picker__cell.is-between-hover":N,"date-picker__cell.is-disabled":C,"date-picker__cell--out-month":d.get("month")!==U.get("month"),"date-picker__cell--today":!M&&!Q&&d.isSame(v(),"date")}),children:d.get("date")})},i)})},a))})]})]})}const ut={"date-picker":"^date-picker","date-picker.is-disabled":"is-disabled","date-picker--small":"^date-picker--small","date-picker--medium":"^date-picker--medium","date-picker--large":"^date-picker--large","date-picker__input":"^date-picker__input","date-picker__indicator":"^date-picker__indicator","date-picker__separator":"^date-picker__separator","date-picker__clear":"^date-picker__clear","date-picker__icon":"^date-picker__icon","date-picker-popup":"^date-picker-popup","date-picker__preset":"^date-picker__preset","date-picker__preset-option":"^date-picker__preset-option","date-picker__panel-wrapper":"^date-picker__panel-wrapper","date-picker__panel":"^date-picker__panel","date-picker__header":"^date-picker__header","date-picker__header-button":"^date-picker__header-button","date-picker__header-date":"^date-picker__header-date","date-picker__table":"^date-picker__table","date-picker__cell":"^date-picker__cell","date-picker__cell.is-active":"is-active","date-picker__cell.is-hover":"is-hover","date-picker__cell.is-between":"is-between","date-picker__cell.is-between-hover":"is-between-hover","date-picker__cell.is-disabled":"is-disabled","date-picker__cell--out-month":"^date-picker__cell--out-month","date-picker__cell--today":"^date-picker__cell--today","date-picker__footer":"^date-picker__footer","time-picker__panel":"^time-picker__panel","time-picker__header":"^time-picker__header","time-picker__column":"^time-picker__column","time-picker__cell":"^time-picker__cell","time-picker__cell.is-active":"is-active","time-picker__cell.is-disabled":"is-disabled"};function bt(W){const{ref:de,styleOverrides:w,styleProvider:f,formControl:m,model:G,defaultModel:ne,visible:ue,defaultVisible:V,placeholder:H,range:h=!1,format:F,order:pe="ascend",clearable:L=!1,size:A,disabled:_e=!1,presetDate:I,config:U,showTime:k=!1,escClosable:ce=!0,inputProps:p,onModelChange:ae,onVisibleChange:$,onClear:J,afterVisibleChange:o,...a}=Pe("DatePicker",W),l=Be(),i=He(ut,{"date-picker":f==null?void 0:f["date-picker"],"time-picker":f==null?void 0:f["time-picker"],"date-picker-popup":f==null?void 0:f["date-picker-popup"]},w),{t:d}=ye(),C=Ie(),M=je(),{contentResizeRef:Q}=ze(),D=_.useRef(null),x=_.useRef(null),N=_.useRef(null),b=_.useRef(null),g=_.useRef(null),Z=_.useRef(null),q=_.useRef(null),X=e=>{var r,t;(r=Z.current)==null||r.call(Z,e),(t=q.current)==null||t.call(q,e)},c=_.useRef({latestFocused:"start",onceVisible:!1,focusAnother:!1,inputValue:[void 0,void 0],rangeDate:[null,null]}),z=T.isUndefined(F)?k?"YYYY-MM-DD HH:mm:ss":"YYYY-MM-DD":F,me=e=>ct(e,pe,k?void 0:"date"),[E,O]=we(V??!1,ue,$),[P,ke]=qe([!1,!1]);P[0]&&(c.current.latestFocused="start"),P[1]&&(c.current.latestFocused="end");const[ee,K]=we(ne??null,G,ae,(e,r)=>tt(e,r,z),m==null?void 0:m.control);let[y,j=null]=h?ee??[null,null]:[ee,null];h&&(T.isNull(ee)?[y,j]=c.current.rangeDate:c.current.rangeDate=[null,null]);const ie=[0,1].map(e=>P[e]&&!T.isUndefined(c.current.inputValue[e])?c.current.inputValue[e]:(()=>{const r=e===0?y:j;return T.isNull(r)?"":v(r).format(z)})()),te=e=>{const r=P.findIndex(t=>t);h?T.isNull(ee)?(c.current.rangeDate[r]=e,c.current.rangeDate.every(t=>!T.isNull(t))&&(c.current.focusAnother=me(c.current.rangeDate),c.current.focusAnother&&c.current.rangeDate.reverse(),c.current.inputValue=[void 0,void 0],K(c.current.rangeDate))):(c.current.inputValue=[void 0,void 0],K(t=>{t[r]=e,c.current.focusAnother=me(t),c.current.focusAnother&&t.reverse()})):(c.current.inputValue=[void 0,void 0],K(e)),C()},[Se=d("DatePicker",h?"Start date":"Select date"),Ee=d("DatePicker","End date")]=h?H??[]:[H],{size:Re,disabled:se}=Ye({size:A,disabled:_e||(m==null?void 0:m.control.disabled)}),Te=Fe(E),Ve=`calc(var(--${l}-zindex-fixed) + ${Te})`,B=Le(()=>{if(E&&D.current&&x.current){const e=x.current.offsetHeight,r=Ze.windowSize.width-De*2,t=Math.min(x.current.scrollWidth,r),R=Ue(D.current,{width:t,height:e},{placement:"bottom-left",inWindow:De});x.current.style.setProperty("--popup-down-transform-origin",R.transformOrigin),x.current.style.top=R.top+"px",x.current.style.left=R.left+"px",x.current.style.maxWidth=r+"px"}});$e(D,B,!E),fe(D,B,void 0,!E),fe(x,B,void 0,!E),fe(Q,B,void 0,!E),_.useImperativeHandle(de,()=>({updatePosition:B}),[B]),Oe(()=>{if(D.current&&g.current){let e=!1;const r=D.current.getBoundingClientRect();if(N.current&&document.activeElement===N.current){const t=N.current.getBoundingClientRect();g.current.style.cssText=`left:${t.left-r.left}px;width:${t.width}px;opacity:1;`,e=!0}if(b.current&&document.activeElement===b.current){const t=b.current.getBoundingClientRect();g.current.style.cssText=`left:${t.left-r.left}px;width:${t.width}px;opacity:1;`,e=!0}e||(g.current.style.cssText+="opacity:0;")}}),_.useEffect(()=>{if(c.current.focusAnother&&document.activeElement){const e=document.activeElement.parentElement;for(let r=0;r<e.childElementCount;r++){const t=e.children.item(r);if(t.tagName.toLowerCase()==="input"&&t!==document.activeElement){t.focus({preventScroll:!0});break}}}c.current.focusAnother=!1});const re=e=>{if(h){const r=P.findIndex(t=>t);T.isNull(r===0?j:y)?(c.current.focusAnother=!0,C()):O(!1)}else O(!1);c.current.focusAnother||X(e)},ve=L&&!T.isNull(ee)&&!E&&!se,xe=e=>{const r=e?0:1,t=e?y:j,R=e?N:b;return n.jsx(ot,{...p==null?void 0:p[r],...i("date-picker__input"),...m==null?void 0:m.inputAria,ref:s=>{var S;R.current=s;const u=Xe((S=p==null?void 0:p[r])==null?void 0:S.ref,s);return()=>{R.current=null,u()}},type:"text",autoComplete:"off",value:ie[r],size:22,placeholder:e?Se:Ee,disabled:se,onValueChange:s=>{if(C(),c.current.inputValue[r]=s,v(s,z,!0).isValid()){const u=v(s,z).toDate();te(u),X(u)}},onKeyDown:s=>{var u,S;if((S=(u=p==null?void 0:p[r])==null?void 0:u.onKeyDown)==null||S.call(u,s),s.code==="Escape")E&&ce&&(s.stopPropagation(),s.preventDefault(),O(!1));else if(s.code==="Enter"&&ie[r]&&v(ie[r],z,!0).isValid()){s.preventDefault();const le=v(ie[r],z).toDate();re(le)}},onFocus:s=>{var u,S,le,be;(S=(u=p==null?void 0:p[r])==null?void 0:u.onFocus)==null||S.call(u,s),(be=(le=c.current).clearTid)==null||be.call(le),ke(ge=>{ge.fill(!1),ge[e?0:1]=!0}),c.current.inputValue=[void 0,void 0],E&&h&&t&&X(t)},onBlur:s=>{var u,S;(S=(u=p==null?void 0:p[r])==null?void 0:u.onBlur)==null||S.call(u,s),c.current.clearTid=M.setTimeout(()=>{ke([!1,!1]),O(!1)},20)}})},oe=e=>{(document.activeElement===N.current||document.activeElement===b.current)&&e.target!==N.current&&e.target!==b.current&&e.button===0&&e.preventDefault()},Ae=Ke({compose:{disabled:se},form:m});return n.jsxs(n.Fragment,{children:[n.jsxs("div",{...a,...he(i("date-picker",`date-picker--${Re}`,{"date-picker.is-disabled":se}),{className:a.className,style:a.style}),...Ae,ref:e=>(D.current=e,()=>{D.current=null}),onMouseDown:e=>{var r;(r=a.onMouseDown)==null||r.call(a,e),oe(e)},onMouseUp:e=>{var r;(r=a.onMouseUp)==null||r.call(a,e),oe(e)},onClick:e=>{var r,t;(r=a.onClick)==null||r.call(a,e),P.some(R=>R)||(t=N.current)==null||t.focus({preventScroll:!0}),O(!0)},children:[xe(!0),h&&n.jsxs(n.Fragment,{children:[n.jsx("div",{...i("date-picker__indicator"),ref:e=>(g.current=e,()=>{g.current=null})}),n.jsx("div",{...i("date-picker__separator"),children:n.jsx(Y,{children:n.jsx(rt,{})})}),xe(!1)]}),ve&&n.jsx("div",{...i("date-picker__clear"),role:"button","aria-label":d("Clear"),onClick:e=>{e.stopPropagation(),c.current.inputValue=[void 0,void 0],K(null),J==null||J()},children:n.jsx(Y,{children:n.jsx(et,{})})}),n.jsx("div",{...he(i("date-picker__icon"),{style:{visibility:ve?"hidden":void 0}}),children:n.jsx(Y,{children:n.jsx(lt,{})})})]}),n.jsx(We,{selector:()=>{let e=document.getElementById(`${l}-date-picker-root`);return e||(e=document.createElement("div"),e.id=`${l}-date-picker-root`,document.body.appendChild(e)),e},children:n.jsx(Ge,{enter:E,name:`${l}-popup-down`,duration:Je,onSkipEnter:()=>{B();const e=()=>{const r=P[0]?y:j;r&&X(r)};h?e():c.current.onceVisible||(c.current.onceVisible=!0,e())},onBeforeEnter:()=>{B();const e=()=>{const r=P[0]?y:j;r&&X(r)};h?e():c.current.onceVisible||(c.current.onceVisible=!0,e())},onAfterEnter:()=>{o==null||o(!0)},onAfterLeave:()=>{o==null||o(!1)},children:(e,r)=>n.jsxs("div",{...he(i("date-picker-popup"),{style:{zIndex:Ve,...r?{display:"none"}:void 0}}),ref:t=>(x.current=t,e(t),()=>{x.current=null,e(null)}),onMouseDown:t=>{oe(t)},onMouseUp:t=>{oe(t)},children:[I&&n.jsx("ul",{...i("date-picker__preset"),children:Object.keys(I).map(t=>{const R=()=>{const s=I[t]();c.current.inputValue=[void 0,void 0],h?T.isArray(s)?(K(s),O(!1)):(te(s),re(s)):(K(s),re(s))};return _.createElement("li",{...i("date-picker__preset-option"),key:t,role:"button",onClick:R},t)})}),n.jsxs("div",{...i("date-picker__panel-wrapper"),children:[n.jsx(dt,{ref:t=>(Z.current=t,()=>{Z.current=null}),styled:i,currentSelected:c.current.latestFocused==="start"?y:j,anotherSelected:c.current.latestFocused==="start"?j:y,config:U?(...t)=>U(...t,c.current.latestFocused,[y,j]):void 0,range:h,onDateChange:t=>{te(t),k||re(t)}}),k&&n.jsx(nt,{ref:t=>(q.current=t,()=>{q.current=null}),styled:i,time:c.current.latestFocused==="start"?y:j,format:z,config:k&&!T.isBoolean(k)&&k.config?(...t)=>k.config(...t,c.current.latestFocused,[y,j]):void 0,inDatePicker:!0,onTimeChange:t=>{te(t)}}),n.jsx("div",{...i("date-picker__footer"),children:n.jsx(Qe,{pattern:"link",onClick:()=>{const t=new Date;te(t),re(t)},children:d("DatePicker",k?"Now":"Today")})})]})]})})})]})}export{bt as D};
