import{r as c,u as Ie,a as ze,b as $e,N as Me,U as Fe,o as Be,d as Oe,c as ne,l as b,a5 as V,Q as Ue,Z as He,f as Le,_ as We,$ as ce,a0 as Ge,h as Ye,i as Ze,k as L,a2 as Ke,j as n,m as W,I as G,a3 as Qe,n as qe,a4 as Y,B as Je}from"./index-e8505753.js";import{u as se}from"./useForkRef-909ef508.js";import{u as Xe}from"./MdRoute-9cff1f0e.js";import{S as et}from"./cancel-71a30837.js";import{d as tt,S as it,T as rt,a as nt}from"./utils-d10b0468.js";const ct=M=>c.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",...M},c.createElement("path",{d:"M11.99 2C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2zM12 20c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8zm.5-13H11v6l5.25 3.15.75-1.23-4.5-2.67z"})),st={"time-picker":"^time-picker","time-picker.is-disabled":"is-disabled","time-picker--small":"^time-picker--small","time-picker--medium":"^time-picker--medium","time-picker--large":"^time-picker--large","time-picker__input":"^time-picker__input","time-picker__indicator":"^time-picker__indicator","time-picker__separator":"^time-picker__separator","time-picker__clear":"^time-picker__clear","time-picker__icon":"^time-picker__icon","time-picker-popup":"^time-picker-popup","time-picker__panel":"^time-picker__panel","time-picker__header":"^time-picker__header","time-picker__column":"^time-picker__column","time-picker__cell":"^time-picker__cell","time-picker__cell.is-active":"is-active","time-picker__cell.is-disabled":"is-disabled","time-picker__footer":"^time-picker__footer"},pt=c.forwardRef((M,oe)=>{const{styleOverrides:ae,styleProvider:S,formControl:u,model:le,defaultModel:ue,visible:de,defaultVisible:pe,placeholder:Z,range:p=!1,format:v="HH:mm:ss",order:me="ascend",clearable:fe=!1,size:ve,disabled:ke=!1,config:K,escClosable:he=!0,inputRef:y,inputRender:F,onModelChange:_e,onVisibleChange:ge,onClear:B,afterVisibleChange:T,...o}=Ie("TimePicker",M),O=ze(),m=$e(st,{"time-picker":S==null?void 0:S["time-picker"],"time-picker-popup":S==null?void 0:S["time-picker-popup"]},ae),{t:A}=Me(),U=Fe(),xe=Be(),{pageScrollRef:be,contentResizeRef:Se}=Oe(),w=c.useRef(null),j=c.useRef(null),k=c.useRef(null),E=c.useRef(null),D=c.useRef(null),ye=se(k,y==null?void 0:y[0]),Te=se(E,y==null?void 0:y[1]),s=c.useRef(null),r=c.useRef({latestFocused:"start",onceVisible:!1,focusAnother:!1,inputValue:[void 0,void 0],rangeDate:[null,null]}),Q=e=>nt(e,me),[l,R]=ne(pe??!1,de,ge),[h,q]=Xe([!1,!1]);h[0]&&(r.current.latestFocused="start"),h[1]&&(r.current.latestFocused="end");const[P,N]=ne(ue??null,le,_e,(e,t)=>tt(e,t,v),u==null?void 0:u.control);let[_,g=null]=p?P??[null,null]:[P,null];p&&(b.isNull(P)?[_,g]=r.current.rangeDate:r.current.rangeDate=[null,null]);const I=[0,1].map(e=>h[e]&&!b.isUndefined(r.current.inputValue[e])?r.current.inputValue[e]:(()=>{const t=e===0?_:g;return b.isNull(t)?"":V(t).format(v)})()),H=e=>{const t=h.findIndex(i=>i);p?b.isNull(P)?(r.current.rangeDate[t]=e,r.current.rangeDate.every(i=>!b.isNull(i))&&(r.current.focusAnother=Q(r.current.rangeDate),r.current.focusAnother&&r.current.rangeDate.reverse(),r.current.inputValue=[void 0,void 0],N(r.current.rangeDate))):(r.current.inputValue=[void 0,void 0],N(i=>{i[t]=e,r.current.focusAnother=Q(i),r.current.focusAnother&&i.reverse()})):(r.current.inputValue=[void 0,void 0],N(e)),U()},[we=A("TimePicker",p?"Start time":"Select time"),Ee=A("TimePicker","End time")]=p?Z??[]:[Z],{size:je,disabled:z}=Ue({size:ve,disabled:ke||(u==null?void 0:u.control.disabled)}),De=He(l),Re=`calc(var(--${O}-zindex-fixed) + ${De})`,[J,Pe]=c.useState(),[Ce,Ve]=c.useState({top:"-200vh",left:"-200vw"}),f=Le(()=>{if(l&&w.current&&j.current){const e=j.current.offsetHeight,t=We.windowSize.width-ce*2,i=Math.min(j.current.scrollWidth,t),d=Ge(w.current,{width:i,height:e},{placement:"bottom-left",inWindow:ce});Pe(d.transformOrigin),Ve({top:d.top,left:d.left,maxWidth:t})}}),Ae=Ye(f,!l);Ze(be,"scroll",f,{passive:!0},!l||Ae),L(w,f,void 0,!l),L(j,f,void 0,!l),L(Se,f,void 0,!l),c.useImperativeHandle(oe,()=>({updatePosition:f}),[f]),c.useEffect(()=>{if(w.current&&D.current){let e=!1;const t=w.current.getBoundingClientRect();if(k.current&&document.activeElement===k.current){const i=k.current.getBoundingClientRect();D.current.style.cssText=`left:${i.left-t.left}px;width:${i.width}px;opacity:1;`,e=!0}if(E.current&&document.activeElement===E.current){const i=E.current.getBoundingClientRect();D.current.style.cssText=`left:${i.left-t.left}px;width:${i.width}px;opacity:1;`,e=!0}e||(D.current.style.cssText+="opacity:0;")}}),c.useEffect(()=>{if(r.current.focusAnother&&document.activeElement){const e=document.activeElement.parentElement;for(let t=0;t<e.childElementCount;t++){const i=e.children.item(t);if(i.tagName.toLowerCase()==="input"&&i!==document.activeElement){i.focus({preventScroll:!0});break}}}r.current.focusAnother=!1});const X=e=>{var t;if(p){const i=h.findIndex(d=>d);b.isNull(i===0?g:_)?(r.current.focusAnother=!0,U()):R(!1)}else R(!1);r.current.focusAnother||(t=s.current)==null||t.call(s,e)},ee=fe&&!b.isNull(P)&&!l&&!z,te=e=>{const t=e?0:1,i=e?_:g,d=F==null?void 0:F[t],ie=n.jsx("input",{...m("time-picker__input"),...u==null?void 0:u.inputAria,ref:e?ye:Te,type:"text",autoComplete:"off",value:I[t],size:10,placeholder:e?we:Ee,disabled:z,onChange:a=>{var x;if(U(),r.current.inputValue[t]=a.currentTarget.value,V(a.currentTarget.value,v,!0).isValid()){const C=V(a.currentTarget.value,v).toDate();H(C),(x=s.current)==null||x.call(s,C)}},onKeyDown:a=>{if(a.code==="Escape")l&&he&&(a.stopPropagation(),a.preventDefault(),R(!1));else if(a.code==="Enter"&&I[t]&&V(I[t],v,!0).isValid()){a.preventDefault();const x=V(I[t],v).toDate();X(x)}},onFocus:()=>{var a,x,C;(x=(a=r.current).clearTid)==null||x.call(a),q(re=>{re.fill(!1),re[e?0:1]=!0}),r.current.inputValue=[void 0,void 0],l&&p&&i&&((C=s.current)==null||C.call(s,i))},onBlur:()=>{r.current.clearTid=xe.setTimeout(()=>{q([!1,!1]),R(!1)},20)}});return d?d(ie):ie},$=e=>{(document.activeElement===k.current||document.activeElement===E.current)&&e.target!==k.current&&e.target!==E.current&&e.button===0&&e.preventDefault()},Ne=Ke({compose:{disabled:z},form:u});return n.jsxs(n.Fragment,{children:[n.jsxs("div",{...o,...W(m("time-picker",`time-picker--${je}`,{"time-picker.is-disabled":z}),{className:o.className,style:o.style}),...Ne,ref:w,onMouseDown:e=>{var t;(t=o.onMouseDown)==null||t.call(o,e),$(e)},onMouseUp:e=>{var t;(t=o.onMouseUp)==null||t.call(o,e),$(e)},onClick:e=>{var t,i;(t=o.onClick)==null||t.call(o,e),h.some(d=>d)||(i=k.current)==null||i.focus({preventScroll:!0}),R(!0)},children:[te(!0),p&&n.jsxs(n.Fragment,{children:[n.jsx("div",{...m("time-picker__indicator"),ref:D}),n.jsx("div",{...m("time-picker__separator"),children:n.jsx(G,{children:n.jsx(it,{})})}),te(!1)]}),ee&&n.jsx("div",{...m("time-picker__clear"),role:"button","aria-label":A("Clear"),onClick:e=>{e.stopPropagation(),r.current.inputValue=[void 0,void 0],N(null),B==null||B()},children:n.jsx(G,{children:n.jsx(et,{})})}),n.jsx("div",{...W(m("time-picker__icon"),{style:{visibility:ee?"hidden":void 0}}),children:n.jsx(G,{children:n.jsx(ct,{})})})]}),n.jsx(Qe,{selector:()=>{let e=document.getElementById(`${O}-time-picker-root`);return e||(e=document.createElement("div"),e.id=`${O}-time-picker-root`,document.body.appendChild(e)),e},children:n.jsx(qe,{enter:l,during:Y,afterRender:()=>{f();const e=()=>{var i;const t=h[0]?_:g;t&&((i=s.current)==null||i.call(s,t))};p?e():r.current.onceVisible||(r.current.onceVisible=!0,e())},afterEnter:()=>{T==null||T(!0)},afterLeave:()=>{T==null||T(!1)},children:e=>{let t={};switch(e){case"enter":t={transform:"scaleY(0.7)",opacity:0};break;case"entering":t={transition:["transform","opacity"].map(i=>`${i} ${Y}ms ease-out`).join(", "),transformOrigin:J};break;case"leaving":t={transform:"scaleY(0.7)",opacity:0,transition:["transform","opacity"].map(i=>`${i} ${Y}ms ease-in`).join(", "),transformOrigin:J};break;case"leaved":t={display:"none"};break}return n.jsxs("div",{...W(m("time-picker-popup"),{style:{zIndex:Re,...Ce,...t}}),ref:j,onMouseDown:i=>{$(i)},onMouseUp:i=>{$(i)},children:[n.jsx(rt,{ref:s,styled:m,time:r.current.latestFocused==="start"?_:g,format:v,config:K?(...i)=>K(...i,r.current.latestFocused,[_,g]):void 0,onTimeChange:i=>{H(i)}}),n.jsx("div",{...m("time-picker__footer"),children:n.jsx(Je,{pattern:"link",onClick:()=>{const i=new Date;H(i),X(i)},children:A("TimePicker","Now")})})]})}})})]})});export{pt as T};
