import{r as s,v as Ee,o as Te,f as Be,N as m,i as Pe,j as r,I as z,E as Fe,u as Le,a as $e,b as Oe,d as Ue,z as We,e as Ke,l as S,c as ye,x as Ge,H as Je,g as Ze,J as qe,h as Qe,k as ke,L as Xe,m as ve,P as et,n as tt,M as ge,B as rt,R as nt,W as Se}from"./index-551d17bd.js";import{u as Re}from"./useForkRef-a68dff22.js";import{u as ct}from"./MdRoute-68462a21.js";import{S as at}from"./cancel-a4d283c7.js";import{d as it,S as st,T as ot,o as lt}from"./utils-aff6f239.js";import{S as dt}from"./keyboard_arrow_left-58bbe66a.js";import{S as ut,a as pt}from"./keyboard_double_arrow_right-17d0edec.js";const ft=G=>s.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",...G},s.createElement("path",{d:"M20 3h-1V1h-2v2H7V1H5v2H4c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 18H4V10h16v11zm0-13H4V5h16v3z"})),_t=s.forwardRef((G,le)=>{const{styled:x,currentSelected:d,anotherSelected:p,config:J,range:ee,onDateChange:de}=G,R=s.useRef({}),{t:C,lang:f}=Ee(),B=Te(),ue=Be(()=>window),F=d?m(d):m().set("hour",0).set("minute",0).set("second",0),E=p?m(p):null,[pe,V]=s.useState(F.toDate()),L=m(pe),[_,te]=s.useState(null),T=(o,l)=>{const a=()=>{V(i=>{const w=m(i);return w.set(o,w.get(o)+l).toDate()})};a();const u=()=>{a(),R.current.clearLoop=B.setTimeout(()=>u(),50)};R.current.clearTid=B.setTimeout(()=>u(),400)},$=()=>{var o,l,a,u;(l=(o=R.current).clearLoop)==null||l.call(o),(u=(a=R.current).clearTid)==null||u.call(a)};Pe(ue,"mouseup",$),s.useImperativeHandle(le,()=>V,[]);const O=(o,l)=>({onMouseDown:a=>{a.button===0&&T(o,l)},onTouchStart:()=>{T(o,l)},onTouchEnd:()=>{$()}}),fe=(()=>{const o=L.set("date",1),l=[];let a=[];for(let u=0,i=-o.day();u<7*6;u++,i++)a.push(o.add(i,"day").toDate()),a.length===7&&(l.push(a),a=[]);return l})();return r.jsxs("div",{...x("date-picker__panel"),children:[r.jsxs("div",{...x("date-picker__header"),children:[r.jsx("button",{...x("date-picker__header-button"),...O("year",-1),title:C("DatePicker","Previous year"),children:r.jsx(z,{children:r.jsx(ut,{})})}),r.jsx("button",{...x("date-picker__header-button"),...O("month",-1),title:C("DatePicker","Previous month"),children:r.jsx(z,{children:r.jsx(dt,{})})}),r.jsx("span",{...x("date-picker__header-date"),children:L.format(f==="zh-CN"?"YYYY年 M月":"MMM YYYY")}),r.jsx("button",{...x("date-picker__header-button"),...O("month",1),title:C("DatePicker","Next month"),children:r.jsx(z,{children:r.jsx(Fe,{})})}),r.jsx("button",{...x("date-picker__header-button"),...O("year",1),title:C("DatePicker","Next year"),children:r.jsx(z,{children:r.jsx(pt,{})})})]}),r.jsxs("table",{...x("date-picker__table"),children:[r.jsx("thead",{children:r.jsx("tr",{children:m.weekdaysMin().map(o=>r.jsx("th",{children:o},o))})}),r.jsx("tbody",{children:fe.map((o,l)=>r.jsx("tr",{children:o.map((a,u)=>{const i=m(a),{disabled:w=!1}=(J==null?void 0:J(a))??{},k=d&&i.isSame(F,"date"),A=E&&i.isSame(E,"date"),re=!k&&!A&&E&&i.isSame(_,"date"),_e=!k&&!k&&!re&&d&&E&&i.isBetween(F,E,"date"),he=!k&&_&&E&&i.isBetween(_,E,"date");return r.jsx("td",{style:{pointerEvents:w?"none":void 0},onClick:()=>{V(a),de(F.set("year",i.year()).set("month",i.month()).set("date",i.date()).toDate())},onMouseEnter:()=>{var v,h;(h=(v=R.current).clearHoverTid)==null||h.call(v),te(a)},onMouseLeave:()=>{var v,h;(h=(v=R.current).clearHoverTid)==null||h.call(v),R.current.clearHoverTid=B.setTimeout(()=>te(null),50)},children:r.jsx("div",{...x("date-picker__cell",{"date-picker__cell.is-active":ee?A:k,"date-picker__cell.is-hover":re||ee&&k,"date-picker__cell.is-between":_e,"date-picker__cell.is-between-hover":he,"date-picker__cell.is-disabled":w,"date-picker__cell--out-month":i.get("month")!==L.get("month"),"date-picker__cell--today":!k&&!A&&i.isSame(m(),"date")}),children:i.get("date")})},u)})},l))})]})]})}),ht={"date-picker":"^date-picker","date-picker.is-disabled":"is-disabled","date-picker--small":"^date-picker--small","date-picker--medium":"^date-picker--medium","date-picker--large":"^date-picker--large","date-picker__input":"^date-picker__input","date-picker__indicator":"^date-picker__indicator","date-picker__separator":"^date-picker__separator","date-picker__clear":"^date-picker__clear","date-picker__icon":"^date-picker__icon","date-picker-popup":"^date-picker-popup","date-picker__preset":"^date-picker__preset","date-picker__preset-option":"^date-picker__preset-option","date-picker__panel-wrapper":"^date-picker__panel-wrapper","date-picker__panel":"^date-picker__panel","date-picker__header":"^date-picker__header","date-picker__header-button":"^date-picker__header-button","date-picker__header-date":"^date-picker__header-date","date-picker__table":"^date-picker__table","date-picker__cell":"^date-picker__cell","date-picker__cell.is-active":"is-active","date-picker__cell.is-hover":"is-hover","date-picker__cell.is-between":"is-between","date-picker__cell.is-between-hover":"is-between-hover","date-picker__cell.is-disabled":"is-disabled","date-picker__cell--out-month":"^date-picker__cell--out-month","date-picker__cell--today":"^date-picker__cell--today","date-picker__footer":"^date-picker__footer","time-picker__panel":"^time-picker__panel","time-picker__header":"^time-picker__header","time-picker__column":"^time-picker__column","time-picker__cell":"^time-picker__cell","time-picker__cell.is-active":"is-active","time-picker__cell.is-disabled":"is-disabled"},Dt=s.forwardRef((G,le)=>{const{styleOverrides:x,styleProvider:d,formControl:p,model:J,defaultModel:ee,visible:de,defaultVisible:R,placeholder:C,range:f=!1,format:B,order:ue="ascend",clearable:F=!1,size:E,disabled:pe=!1,presetDate:V,config:L,showTime:_=!1,escClosable:te=!0,inputRef:T,inputRender:$,onModelChange:O,onVisibleChange:fe,onClear:o,afterVisibleChange:l,...a}=Le("DatePicker",G),u=$e(),i=Oe(ht,{"date-picker":d==null?void 0:d["date-picker"],"time-picker":d==null?void 0:d["time-picker"],"date-picker-popup":d==null?void 0:d["date-picker-popup"]},x),w=Ue(),{t:k}=Ee(),A=We(),re=Te(),{pageScrollRef:_e,contentResizeRef:he}=Ke(),v=s.useRef(null),h=s.useRef(null),N=s.useRef(null),U=s.useRef(null),Z=s.useRef(null),Me=Re(N,T==null?void 0:T[0]),Ce=Re(U,T==null?void 0:T[1]),ne=s.useRef(null),ce=s.useRef(null),ae=e=>{var n,t;(n=ne.current)==null||n.call(ne,e),(t=ce.current)==null||t.call(ce,e)},c=s.useRef({latestFocused:"start",onceVisible:!1,focusAnother:!1,inputValue:[void 0,void 0],rangeDate:[null,null]}),H=S.isUndefined(B)?_?"YYYY-MM-DD HH:mm:ss":"YYYY-MM-DD":B,xe=e=>lt(e,ue,_?void 0:"date"),[b,W]=ye(R??!1,de,fe),[Y,be]=ct([!1,!1]);Y[0]&&(c.current.latestFocused="start"),Y[1]&&(c.current.latestFocused="end");const[q,K]=ye(ee??null,J,O,(e,n)=>it(e,n,H),p==null?void 0:p.control);let[D,j=null]=f?q??[null,null]:[q,null];f&&(S.isNull(q)?[D,j]=c.current.rangeDate:c.current.rangeDate=[null,null]);const ie=[0,1].map(e=>Y[e]&&!S.isUndefined(c.current.inputValue[e])?c.current.inputValue[e]:(()=>{const n=e===0?D:j;return S.isNull(n)?"":m(n).format(H)})()),Q=e=>{const n=Y.findIndex(t=>t);f?S.isNull(q)?(c.current.rangeDate[n]=e,c.current.rangeDate.every(t=>!S.isNull(t))&&(c.current.focusAnother=xe(c.current.rangeDate),c.current.focusAnother&&c.current.rangeDate.reverse(),c.current.inputValue=[void 0,void 0],K(c.current.rangeDate))):(c.current.inputValue=[void 0,void 0],K(t=>{t[n]=e,c.current.focusAnother=xe(t),c.current.focusAnother&&t.reverse()})):(c.current.inputValue=[void 0,void 0],K(e)),A()},[Ve=k("DatePicker",f?"Start date":"Select date"),Ae=k("DatePicker","End date")]=f?C??[]:[C],{size:Ne,disabled:se}=Ge({size:E,disabled:pe||(p==null?void 0:p.control.disabled)}),He=Je(b),Ye=`calc(var(--${u}-zindex-fixed) + ${He})`,me=s.useRef(),M=Ze(()=>{if(b&&v.current&&h.current){const e=h.current.offsetHeight,n=nt.windowSize.width-Se*2,t=Math.min(h.current.scrollWidth,n),y=qe(v.current,{width:t,height:e},{placement:"bottom-left",inWindow:Se});me.current=y.transformOrigin,w.classes.position&&h.current.classList.toggle(w.classes.position,!1),w.replaceRule("position",{top:y.top,left:y.left,maxWidth:n}),h.current.classList.toggle(w.classes.position,!0)}}),Ie=Qe(M,!b);Pe(_e,"scroll",M,{passive:!0},!b||Ie),ke(v,M,void 0,!b),ke(h,M,void 0,!b),ke(he,M,void 0,!b),s.useImperativeHandle(le,()=>({updatePosition:M}),[M]),s.useEffect(()=>{if(v.current&&Z.current){let e=!1;const n=v.current.getBoundingClientRect();if(N.current&&document.activeElement===N.current){const t=N.current.getBoundingClientRect();Z.current.style.cssText=`left:${t.left-n.left}px;width:${t.width}px;opacity:1;`,e=!0}if(U.current&&document.activeElement===U.current){const t=U.current.getBoundingClientRect();Z.current.style.cssText=`left:${t.left-n.left}px;width:${t.width}px;opacity:1;`,e=!0}e||(Z.current.style.cssText+="opacity:0;")}}),s.useEffect(()=>{if(c.current.focusAnother&&document.activeElement){const e=document.activeElement.parentElement;for(let n=0;n<e.childElementCount;n++){const t=e.children.item(n);if(t.tagName.toLowerCase()==="input"&&t!==document.activeElement){t.focus({preventScroll:!0});break}}}c.current.focusAnother=!1});const X=e=>{if(f){const n=Y.findIndex(t=>t);S.isNull(n===0?j:D)?(c.current.focusAnother=!0,A()):W(!1)}else W(!1);c.current.focusAnother||ae(e)},we=F&&!S.isNull(q)&&!b&&!se,De=e=>{const n=e?0:1,t=e?D:j,y=$==null?void 0:$[n],P=r.jsx("input",{...i("date-picker__input"),...p==null?void 0:p.inputAria,ref:e?Me:Ce,type:"text",autoComplete:"off",value:ie[n],size:22,placeholder:e?Ve:Ae,disabled:se,onChange:g=>{if(A(),c.current.inputValue[n]=g.currentTarget.value,m(g.currentTarget.value,H,!0).isValid()){const I=m(g.currentTarget.value,H).toDate();Q(I),ae(I)}},onKeyDown:g=>{if(g.code==="Escape")b&&te&&(g.stopPropagation(),g.preventDefault(),W(!1));else if(g.code==="Enter"&&ie[n]&&m(ie[n],H,!0).isValid()){g.preventDefault();const I=m(ie[n],H).toDate();X(I)}},onFocus:()=>{var g,I;(I=(g=c.current).clearTid)==null||I.call(g),be(je=>{je.fill(!1),je[e?0:1]=!0}),c.current.inputValue=[void 0,void 0],b&&f&&t&&ae(t)},onBlur:()=>{c.current.clearTid=re.setTimeout(()=>{be([!1,!1]),W(!1)},20)}});return y?y(P):P},oe=e=>{(document.activeElement===N.current||document.activeElement===U.current)&&e.target!==N.current&&e.target!==U.current&&e.button===0&&e.preventDefault()},ze=Xe({compose:{disabled:se},form:p});return r.jsxs(r.Fragment,{children:[r.jsxs("div",{...a,...ve(i("date-picker",`date-picker--${Ne}`,{"date-picker.is-disabled":se}),{className:a.className,style:a.style}),...ze,ref:v,onMouseDown:e=>{var n;(n=a.onMouseDown)==null||n.call(a,e),oe(e)},onMouseUp:e=>{var n;(n=a.onMouseUp)==null||n.call(a,e),oe(e)},onClick:e=>{var n,t;(n=a.onClick)==null||n.call(a,e),Y.some(y=>y)||(t=N.current)==null||t.focus({preventScroll:!0}),W(!0)},children:[De(!0),f&&r.jsxs(r.Fragment,{children:[r.jsx("div",{...i("date-picker__indicator"),ref:Z}),r.jsx("div",{...i("date-picker__separator"),children:r.jsx(z,{children:r.jsx(st,{})})}),De(!1)]}),we&&r.jsx("div",{...i("date-picker__clear"),role:"button","aria-label":k("Clear"),onClick:e=>{e.stopPropagation(),c.current.inputValue=[void 0,void 0],K(null),o==null||o()},children:r.jsx(z,{children:r.jsx(at,{})})}),r.jsx("div",{...ve(i("date-picker__icon"),{style:{visibility:we?"hidden":void 0}}),children:r.jsx(z,{children:r.jsx(ft,{})})})]}),r.jsx(et,{selector:()=>{let e=document.getElementById(`${u}-date-picker-root`);return e||(e=document.createElement("div"),e.id=`${u}-date-picker-root`,document.body.appendChild(e)),e},children:r.jsx(tt,{enter:b,during:ge,afterRender:()=>{M();const e=()=>{const n=Y[0]?D:j;n&&ae(n)};f?e():c.current.onceVisible||(c.current.onceVisible=!0,e())},afterEnter:()=>{l==null||l(!0)},afterLeave:()=>{l==null||l(!1)},children:e=>{let n={};switch(e){case"enter":n={transform:"scaleY(0.7)",opacity:0};break;case"entering":n={transition:["transform","opacity"].map(t=>`${t} ${ge}ms ease-out`).join(", "),transformOrigin:me.current};break;case"leaving":n={transform:"scaleY(0.7)",opacity:0,transition:["transform","opacity"].map(t=>`${t} ${ge}ms ease-in`).join(", "),transformOrigin:me.current};break;case"leaved":n={display:"none"};break}return r.jsxs("div",{...ve(i("date-picker-popup"),{style:{zIndex:Ye,...n}}),ref:h,onMouseDown:t=>{oe(t)},onMouseUp:t=>{oe(t)},children:[V&&r.jsx("ul",{...i("date-picker__preset"),children:Object.keys(V).map(t=>{const y=()=>{const P=V[t]();c.current.inputValue=[void 0,void 0],f?S.isArray(P)?(K(P),W(!1)):(Q(P),X(P)):(K(P),X(P))};return s.createElement("li",{...i("date-picker__preset-option"),key:t,role:"button",onClick:y},t)})}),r.jsxs("div",{...i("date-picker__panel-wrapper"),children:[r.jsx(_t,{ref:ne,styled:i,currentSelected:c.current.latestFocused==="start"?D:j,anotherSelected:c.current.latestFocused==="start"?j:D,config:L?(...t)=>L(...t,c.current.latestFocused,[D,j]):void 0,range:f,onDateChange:t=>{Q(t),_||X(t)}}),_&&r.jsx(ot,{ref:ce,styled:i,time:c.current.latestFocused==="start"?D:j,format:H,config:_&&!S.isBoolean(_)&&_.config?(...t)=>_.config(...t,c.current.latestFocused,[D,j]):void 0,inDatePicker:!0,onTimeChange:t=>{Q(t)}}),r.jsx("div",{...i("date-picker__footer"),children:r.jsx(rt,{pattern:"link",onClick:()=>{const t=new Date;Q(t),X(t)},children:k("DatePicker",_?"Now":"Today")})})]})]})}})})]})});export{Dt as D};
