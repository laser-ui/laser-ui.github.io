import{r as s,P as Ee,o as Te,f as Be,a6 as m,i as Pe,j as r,I as z,X as Fe,u as $e,a as Le,b as Oe,d as Ue,V as Ke,e as We,l as S,c as ye,R as Ge,_ as Je,g as Xe,$ as Ze,a0 as Se,a1 as qe,h as Qe,k as ke,a3 as et,m as ve,a4 as tt,n as rt,a5 as ge,B as nt}from"./index-86615c68.js";import{u as Re}from"./useForkRef-5b013943.js";import{u as at}from"./MdRoute-ea9a5f40.js";import{S as ct}from"./cancel-d0e1a9de.js";import{d as it,S as st,T as ot,o as lt}from"./utils-dbd39d48.js";import{S as dt}from"./keyboard_arrow_left-ac8c48bf.js";import{S as ut,a as pt}from"./keyboard_double_arrow_right-6619e89c.js";const ft=G=>s.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",...G},s.createElement("path",{d:"M20 3h-1V1h-2v2H7V1H5v2H4c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 18H4V10h16v11zm0-13H4V5h16v3z"})),_t=s.forwardRef((G,le)=>{const{styled:x,currentSelected:d,anotherSelected:p,config:J,range:ee,onDateChange:de}=G,R=s.useRef({}),{t:V,lang:f}=Ee(),B=Te(),ue=Be(()=>window),F=d?m(d):m().set("hour",0).set("minute",0).set("second",0),E=p?m(p):null,[pe,C]=s.useState(F.toDate()),$=m(pe),[_,te]=s.useState(null),T=(o,l)=>{const c=()=>{C(i=>{const w=m(i);return w.set(o,w.get(o)+l).toDate()})};c();const u=()=>{c(),R.current.clearLoop=B.setTimeout(()=>u(),50)};R.current.clearTid=B.setTimeout(()=>u(),400)},L=()=>{var o,l,c,u;(l=(o=R.current).clearLoop)==null||l.call(o),(u=(c=R.current).clearTid)==null||u.call(c)};Pe(ue,"mouseup",L),s.useImperativeHandle(le,()=>C,[]);const O=(o,l)=>({onMouseDown:c=>{c.button===0&&T(o,l)},onTouchStart:()=>{T(o,l)},onTouchEnd:()=>{L()}}),fe=(()=>{const o=$.set("date",1),l=[];let c=[];for(let u=0,i=-o.day();u<7*6;u++,i++)c.push(o.add(i,"day").toDate()),c.length===7&&(l.push(c),c=[]);return l})();return r.jsxs("div",{...x("date-picker__panel"),children:[r.jsxs("div",{...x("date-picker__header"),children:[r.jsx("button",{...x("date-picker__header-button"),...O("year",-1),title:V("DatePicker","Previous year"),children:r.jsx(z,{children:r.jsx(ut,{})})}),r.jsx("button",{...x("date-picker__header-button"),...O("month",-1),title:V("DatePicker","Previous month"),children:r.jsx(z,{children:r.jsx(dt,{})})}),r.jsx("span",{...x("date-picker__header-date"),children:$.format(f==="zh-CN"?"YYYY年 M月":"MMM YYYY")}),r.jsx("button",{...x("date-picker__header-button"),...O("month",1),title:V("DatePicker","Next month"),children:r.jsx(z,{children:r.jsx(Fe,{})})}),r.jsx("button",{...x("date-picker__header-button"),...O("year",1),title:V("DatePicker","Next year"),children:r.jsx(z,{children:r.jsx(pt,{})})})]}),r.jsxs("table",{...x("date-picker__table"),children:[r.jsx("thead",{children:r.jsx("tr",{children:m.weekdaysMin().map(o=>r.jsx("th",{children:o},o))})}),r.jsx("tbody",{children:fe.map((o,l)=>r.jsx("tr",{children:o.map((c,u)=>{const i=m(c),{disabled:w=!1}=(J==null?void 0:J(c))??{},k=d&&i.isSame(F,"date"),A=E&&i.isSame(E,"date"),re=!k&&!A&&E&&i.isSame(_,"date"),_e=!k&&!k&&!re&&d&&E&&i.isBetween(F,E,"date"),he=!k&&_&&E&&i.isBetween(_,E,"date");return r.jsx("td",{style:{pointerEvents:w?"none":void 0},onClick:()=>{C(c),de(F.set("year",i.year()).set("month",i.month()).set("date",i.date()).toDate())},onMouseEnter:()=>{var v,h;(h=(v=R.current).clearHoverTid)==null||h.call(v),te(c)},onMouseLeave:()=>{var v,h;(h=(v=R.current).clearHoverTid)==null||h.call(v),R.current.clearHoverTid=B.setTimeout(()=>te(null),50)},children:r.jsx("div",{...x("date-picker__cell",{"date-picker__cell.is-active":ee?A:k,"date-picker__cell.is-hover":re||ee&&k,"date-picker__cell.is-between":_e,"date-picker__cell.is-between-hover":he,"date-picker__cell.is-disabled":w,"date-picker__cell--out-month":i.get("month")!==$.get("month"),"date-picker__cell--today":!k&&!A&&i.isSame(m(),"date")}),children:i.get("date")})},u)})},l))})]})]})}),ht={"date-picker":"^date-picker","date-picker.is-disabled":"is-disabled","date-picker--small":"^date-picker--small","date-picker--medium":"^date-picker--medium","date-picker--large":"^date-picker--large","date-picker__input":"^date-picker__input","date-picker__indicator":"^date-picker__indicator","date-picker__separator":"^date-picker__separator","date-picker__clear":"^date-picker__clear","date-picker__icon":"^date-picker__icon","date-picker-popup":"^date-picker-popup","date-picker__preset":"^date-picker__preset","date-picker__preset-option":"^date-picker__preset-option","date-picker__panel-wrapper":"^date-picker__panel-wrapper","date-picker__panel":"^date-picker__panel","date-picker__header":"^date-picker__header","date-picker__header-button":"^date-picker__header-button","date-picker__header-date":"^date-picker__header-date","date-picker__table":"^date-picker__table","date-picker__cell":"^date-picker__cell","date-picker__cell.is-active":"is-active","date-picker__cell.is-hover":"is-hover","date-picker__cell.is-between":"is-between","date-picker__cell.is-between-hover":"is-between-hover","date-picker__cell.is-disabled":"is-disabled","date-picker__cell--out-month":"^date-picker__cell--out-month","date-picker__cell--today":"^date-picker__cell--today","date-picker__footer":"^date-picker__footer","time-picker__panel":"^time-picker__panel","time-picker__header":"^time-picker__header","time-picker__column":"^time-picker__column","time-picker__cell":"^time-picker__cell","time-picker__cell.is-active":"is-active","time-picker__cell.is-disabled":"is-disabled"},Dt=s.forwardRef((G,le)=>{const{styleOverrides:x,styleProvider:d,formControl:p,model:J,defaultModel:ee,visible:de,defaultVisible:R,placeholder:V,range:f=!1,format:B,order:ue="ascend",clearable:F=!1,size:E,disabled:pe=!1,presetDate:C,config:$,showTime:_=!1,escClosable:te=!0,inputRef:T,inputRender:L,onModelChange:O,onVisibleChange:fe,onClear:o,afterVisibleChange:l,...c}=$e("DatePicker",G),u=Le(),i=Oe(ht,{"date-picker":d==null?void 0:d["date-picker"],"time-picker":d==null?void 0:d["time-picker"],"date-picker-popup":d==null?void 0:d["date-picker-popup"]},x),w=Ue(),{t:k}=Ee(),A=Ke(),re=Te(),{pageScrollRef:_e,contentResizeRef:he}=We(),v=s.useRef(null),h=s.useRef(null),N=s.useRef(null),U=s.useRef(null),X=s.useRef(null),Me=Re(N,T==null?void 0:T[0]),Ve=Re(U,T==null?void 0:T[1]),ne=s.useRef(null),ae=s.useRef(null),ce=e=>{var n,t;(n=ne.current)==null||n.call(ne,e),(t=ae.current)==null||t.call(ae,e)},a=s.useRef({latestFocused:"start",onceVisible:!1,focusAnother:!1,inputValue:[void 0,void 0],rangeDate:[null,null]}),Y=S.isUndefined(B)?_?"YYYY-MM-DD HH:mm:ss":"YYYY-MM-DD":B,xe=e=>lt(e,ue,_?void 0:"date"),[b,K]=ye(R??!1,de,fe),[H,be]=at([!1,!1]);H[0]&&(a.current.latestFocused="start"),H[1]&&(a.current.latestFocused="end");const[Z,W]=ye(ee??null,J,O,(e,n)=>it(e,n,Y),p==null?void 0:p.control);let[D,j=null]=f?Z??[null,null]:[Z,null];f&&(S.isNull(Z)?[D,j]=a.current.rangeDate:a.current.rangeDate=[null,null]);const ie=[0,1].map(e=>H[e]&&!S.isUndefined(a.current.inputValue[e])?a.current.inputValue[e]:(()=>{const n=e===0?D:j;return S.isNull(n)?"":m(n).format(Y)})()),q=e=>{const n=H.findIndex(t=>t);f?S.isNull(Z)?(a.current.rangeDate[n]=e,a.current.rangeDate.every(t=>!S.isNull(t))&&(a.current.focusAnother=xe(a.current.rangeDate),a.current.focusAnother&&a.current.rangeDate.reverse(),a.current.inputValue=[void 0,void 0],W(a.current.rangeDate))):(a.current.inputValue=[void 0,void 0],W(t=>{t[n]=e,a.current.focusAnother=xe(t),a.current.focusAnother&&t.reverse()})):(a.current.inputValue=[void 0,void 0],W(e)),A()},[Ce=k("DatePicker",f?"Start date":"Select date"),Ae=k("DatePicker","End date")]=f?V??[]:[V],{size:Ne,disabled:se}=Ge({size:E,disabled:pe||(p==null?void 0:p.control.disabled)}),Ye=Je(b),He=`calc(var(--${u}-zindex-fixed) + ${Ye})`,me=s.useRef(),M=Xe(()=>{if(b&&v.current&&h.current){const e=h.current.offsetHeight,n=Ze.windowSize.width-Se*2,t=Math.min(h.current.scrollWidth,n),y=qe(v.current,{width:t,height:e},{placement:"bottom-left",inWindow:Se});me.current=y.transformOrigin,w.classes.position&&h.current.classList.toggle(w.classes.position,!1),w.replaceRule("position",{top:y.top,left:y.left,maxWidth:n}),h.current.classList.toggle(w.classes.position,!0)}}),Ie=Qe(M,!b);Pe(_e,"scroll",M,{passive:!0},!b||Ie),ke(v,M,void 0,!b),ke(h,M,void 0,!b),ke(he,M,void 0,!b),s.useImperativeHandle(le,()=>({updatePosition:M}),[M]),s.useEffect(()=>{if(v.current&&X.current){let e=!1;const n=v.current.getBoundingClientRect();if(N.current&&document.activeElement===N.current){const t=N.current.getBoundingClientRect();X.current.style.cssText=`left:${t.left-n.left}px;width:${t.width}px;opacity:1;`,e=!0}if(U.current&&document.activeElement===U.current){const t=U.current.getBoundingClientRect();X.current.style.cssText=`left:${t.left-n.left}px;width:${t.width}px;opacity:1;`,e=!0}e||(X.current.style.cssText+="opacity:0;")}}),s.useEffect(()=>{if(a.current.focusAnother&&document.activeElement){const e=document.activeElement.parentElement;for(let n=0;n<e.childElementCount;n++){const t=e.children.item(n);if(t.tagName.toLowerCase()==="input"&&t!==document.activeElement){t.focus({preventScroll:!0});break}}}a.current.focusAnother=!1});const Q=e=>{if(f){const n=H.findIndex(t=>t);S.isNull(n===0?j:D)?(a.current.focusAnother=!0,A()):K(!1)}else K(!1);a.current.focusAnother||ce(e)},we=F&&!S.isNull(Z)&&!b&&!se,De=e=>{const n=e?0:1,t=e?D:j,y=L==null?void 0:L[n],P=r.jsx("input",{...i("date-picker__input"),...p==null?void 0:p.inputAria,ref:e?Me:Ve,type:"text",autoComplete:"off",value:ie[n],size:22,placeholder:e?Ce:Ae,disabled:se,onChange:g=>{if(A(),a.current.inputValue[n]=g.currentTarget.value,m(g.currentTarget.value,Y,!0).isValid()){const I=m(g.currentTarget.value,Y).toDate();q(I),ce(I)}},onKeyDown:g=>{if(g.code==="Escape")b&&te&&(g.stopPropagation(),g.preventDefault(),K(!1));else if(g.code==="Enter"&&ie[n]&&m(ie[n],Y,!0).isValid()){g.preventDefault();const I=m(ie[n],Y).toDate();Q(I)}},onFocus:()=>{var g,I;(I=(g=a.current).clearTid)==null||I.call(g),be(je=>{je.fill(!1),je[e?0:1]=!0}),a.current.inputValue=[void 0,void 0],b&&f&&t&&ce(t)},onBlur:()=>{a.current.clearTid=re.setTimeout(()=>{be([!1,!1]),K(!1)},20)}});return y?y(P):P},oe=e=>{(document.activeElement===N.current||document.activeElement===U.current)&&e.target!==N.current&&e.target!==U.current&&e.button===0&&e.preventDefault()},ze=et({compose:{disabled:se},form:p});return r.jsxs(r.Fragment,{children:[r.jsxs("div",{...c,...ve(i("date-picker",`date-picker--${Ne}`,{"date-picker.is-disabled":se}),{className:c.className,style:c.style}),...ze,ref:v,onMouseDown:e=>{var n;(n=c.onMouseDown)==null||n.call(c,e),oe(e)},onMouseUp:e=>{var n;(n=c.onMouseUp)==null||n.call(c,e),oe(e)},onClick:e=>{var n,t;(n=c.onClick)==null||n.call(c,e),H.some(y=>y)||(t=N.current)==null||t.focus({preventScroll:!0}),K(!0)},children:[De(!0),f&&r.jsxs(r.Fragment,{children:[r.jsx("div",{...i("date-picker__indicator"),ref:X}),r.jsx("div",{...i("date-picker__separator"),children:r.jsx(z,{children:r.jsx(st,{})})}),De(!1)]}),we&&r.jsx("div",{...i("date-picker__clear"),role:"button","aria-label":k("Clear"),onClick:e=>{e.stopPropagation(),a.current.inputValue=[void 0,void 0],W(null),o==null||o()},children:r.jsx(z,{children:r.jsx(ct,{})})}),r.jsx("div",{...ve(i("date-picker__icon"),{style:{visibility:we?"hidden":void 0}}),children:r.jsx(z,{children:r.jsx(ft,{})})})]}),r.jsx(tt,{selector:()=>{let e=document.getElementById(`${u}-date-picker-root`);return e||(e=document.createElement("div"),e.id=`${u}-date-picker-root`,document.body.appendChild(e)),e},children:r.jsx(rt,{enter:b,during:ge,afterRender:()=>{M();const e=()=>{const n=H[0]?D:j;n&&ce(n)};f?e():a.current.onceVisible||(a.current.onceVisible=!0,e())},afterEnter:()=>{l==null||l(!0)},afterLeave:()=>{l==null||l(!1)},children:e=>{let n={};switch(e){case"enter":n={transform:"scaleY(0.7)",opacity:0};break;case"entering":n={transition:["transform","opacity"].map(t=>`${t} ${ge}ms ease-out`).join(", "),transformOrigin:me.current};break;case"leaving":n={transform:"scaleY(0.7)",opacity:0,transition:["transform","opacity"].map(t=>`${t} ${ge}ms ease-in`).join(", "),transformOrigin:me.current};break;case"leaved":n={display:"none"};break}return r.jsxs("div",{...ve(i("date-picker-popup"),{style:{zIndex:He,...n}}),ref:h,onMouseDown:t=>{oe(t)},onMouseUp:t=>{oe(t)},children:[C&&r.jsx("ul",{...i("date-picker__preset"),children:Object.keys(C).map(t=>{const y=()=>{const P=C[t]();a.current.inputValue=[void 0,void 0],f?S.isArray(P)?(W(P),K(!1)):(q(P),Q(P)):(W(P),Q(P))};return s.createElement("li",{...i("date-picker__preset-option"),key:t,role:"button",onClick:y},t)})}),r.jsxs("div",{...i("date-picker__panel-wrapper"),children:[r.jsx(_t,{ref:ne,styled:i,currentSelected:a.current.latestFocused==="start"?D:j,anotherSelected:a.current.latestFocused==="start"?j:D,config:$?(...t)=>$(...t,a.current.latestFocused,[D,j]):void 0,range:f,onDateChange:t=>{q(t),_||Q(t)}}),_&&r.jsx(ot,{ref:ae,styled:i,time:a.current.latestFocused==="start"?D:j,format:Y,config:_&&!S.isBoolean(_)&&_.config?(...t)=>_.config(...t,a.current.latestFocused,[D,j]):void 0,inDatePicker:!0,onTimeChange:t=>{q(t)}}),r.jsx("div",{...i("date-picker__footer"),children:r.jsx(nt,{pattern:"link",onClick:()=>{const t=new Date;q(t),Q(t)},children:k("DatePicker",_?"Now":"Today")})})]})]})}})})]})});export{Dt as D};
