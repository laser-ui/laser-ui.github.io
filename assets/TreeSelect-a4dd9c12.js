import{d as ot,r as f,g as qe,l as $,j as n,V as it,u as at,a as dt,b as ut,x as pt,e as ft,c as xe,z as ht,F as mt,G as _e,H as bt,R as xt,W as Be,J as _t,i as gt,k as De,q as vt,I as ge,K as St,M as Et,m as ve,s as Oe,P as kt,n as yt,N as wt}from"./index-10b5111c.js";import{s as jt}from"./setRef-7888271b.js";import{S as Ct}from"./cancel-6ab3ad69.js";import{S as It}from"./keyboard_arrow_down-119e1bca.js";import{S as Dt}from"./search-8a9b3fe8.js";import{s as Nt}from"./scrollIntoViewIfNeeded-1a86a4ce.js";import{g as Ne}from"./utils-c2ed83c6.js";import{T as I,M as Rt,S as Tt}from"./single-node-19c90d0d.js";import{C as Mt}from"./Checkbox-4594f4f4.js";import{E as Pe}from"./Empty-db2b16d3.js";import{T as At}from"./TreePanel-3650cb4c.js";import{T as Ge}from"./Tag-d5a41e14.js";import{i as Wt}from"./isPrintableCharacter-1b5c27a6.js";import{B as zt}from"./BaseInput-faf991d9.js";function Lt(B){const r=ot.c(31),{ref:Se,namespace:_,styled:d,id:J,list:z,customItem:Y,itemId:L,itemFocused:p,multiple:D,onlyLeafSelectable:ne,virtual:Z,focusVisible:a,onClick:j}=B,E=f.useRef(null),H=f.useRef(null);let N;r[0]===Symbol.for("react.memo_cache_sentinel")?(N=u=>{var T,M,m,P;if(E.current){let b;e:switch(u){case"next":{b=(T=H.current)==null?void 0:T.scrollToStep(E.current,1);break e}case"prev":{b=(M=H.current)==null?void 0:M.scrollToStep(E.current,-1);break e}case"first":{b=(m=H.current)==null?void 0:m.scrollToStart(E.current);break e}case"last":{b=(P=H.current)==null?void 0:P.scrollToEnd(E.current);break e}default:u instanceof HTMLElement&&E.current&&Nt(u,E.current)}return b}},r[0]=N):N=r[0];const Q=qe(N);let X,R;r[1]!==Q?(X=()=>Q,R=[Q],r[1]=Q,r[2]=X,r[3]=R):(X=r[2],R=r[3]),f.useImperativeHandle(Se,X,R);const ce=$.isNumber(Z)?Z:32;let ee;r[4]!==z||r[5]!==ce?(ee={list:z,itemKey:Vt,itemSize:ce,itemFocusable:Ht},r[4]=z,r[5]=ce,r[6]=ee):ee=r[6];const C=ee;let te;r[7]===Symbol.for("react.memo_cache_sentinel")?(te=u=>(H.current=u,()=>{H.current=null}),r[7]=te):te=r[7];const re=Z!==!1;let k;r[8]!==Y||r[9]!==a||r[10]!==(p==null?void 0:p.value)||r[11]!==L||r[12]!==D||r[13]!==_||r[14]!==j||r[15]!==ne||r[16]!==d?(k=(u,T,M)=>{const m=u[I];let P=m.checked;if(!ne){let b=m;for(;b.parent;)if(b=b.parent,b.id===u.value){P=!0;break}}return f.createElement("li",{...d("tree__option",{"tree__option.is-selected":!D&&P,"tree__option.is-disabled":m.disabled}),...M,key:u.value,id:L(u.value),title:u.label,role:"option","aria-selected":m.checked,"aria-disabled":m.disabled,onClick:()=>{j(u)}},a&&(p==null?void 0:p.value)===u.value&&n.jsx("div",{className:`${_}-focus-outline`}),D&&n.jsx("div",{...d("tree__option-checkbox"),children:n.jsx(Mt,{model:m.checked,disabled:m.disabled})}),n.jsx("div",{...d("tree__option-content"),children:Y?Y(m.origin):Ne(m)}))},r[8]=Y,r[9]=a,r[10]=p==null?void 0:p.value,r[11]=L,r[12]=D,r[13]=_,r[14]=j,r[15]=ne,r[16]=d,r[17]=k):k=r[17];const y=p==null?void 0:p.value;let i;r[18]!==J||r[19]!==p||r[20]!==L||r[21]!==z.length||r[22]!==D||r[23]!==d?(i=(u,T)=>n.jsx("ul",{...d("tree"),ref:M=>(E.current=M,()=>{E.current=null}),id:J,tabIndex:-1,role:"listbox","aria-multiselectable":D,"aria-activedescendant":$.isUndefined(p)?void 0:L(p.value),onScroll:T,children:z.length===0?n.jsx(Pe,{style:{padding:"12px 28px"},image:Pe.SIMPLE_IMG}):u}),r[18]=J,r[19]=p,r[20]=L,r[21]=z.length,r[22]=D,r[23]=d,r[24]=i):i=r[24];let O;return r[25]!==re||r[26]!==k||r[27]!==y||r[28]!==i||r[29]!==C?(O=n.jsx(it,{...C,ref:te,enable:re,listSize:264,listPadding:4,itemRender:k,itemFocused:y,placeholder:"li",children:i}),r[25]=re,r[26]=k,r[27]=y,r[28]=i,r[29]=C,r[30]=O):O=r[30],O}function Ht(B){return B[I].enabled}function Vt(B){return B.value}const Ft={"tree-select":"^tree-select","tree-select.is-expanded":"is-expanded","tree-select.is-disabled":"is-disabled","tree-select--small":"^tree-select--small","tree-select--medium":"^tree-select--medium","tree-select--large":"^tree-select--large","tree-select__container":"^tree-select__container","tree-select__content":"^tree-select__content","tree-select__search":"^tree-select__search","tree-select__placeholder-wrapper":"^tree-select__placeholder-wrapper","tree-select__placeholder":"^tree-select__placeholder","tree-select__multiple-count":"^tree-select__multiple-count","tree-select__close":"^tree-select__close","tree-select__clear":"^tree-select__clear","tree-select__icon":"^tree-select__icon","tree-select__arrow":"^tree-select__arrow","tree-select-popup":"^tree-select-popup","tree-select-popup__content":"^tree-select-popup__content","tree-select-popup__loading":"^tree-select-popup__loading","tree-select-popup__loading--empty":"^tree-select-popup__loading--empty",tree:"^tree","tree--line":"^tree--line",tree__group:"^tree__group","tree__group--root":"^tree__group--root",tree__option:"^tree__option","tree__option.is-selected":"is-selected","tree__option.is-disabled":"is-disabled","tree__option--root":"^tree__option--root","tree__option--first":"^tree__option--first","tree__option-dot":"^tree__option-dot","tree__option-icon":"^tree__option-icon","tree__option-arrow":"^tree__option-arrow","tree__option-arrow.is-expand":"is-expand","tree__option-checkbox":"^tree__option-checkbox","tree__option-content":"^tree__option-content",tree__empty:"^tree__empty"};function tr(B){const{ref:r,styleOverrides:Se,styleProvider:_,formControl:d,list:J,model:z,defaultModel:Y,expands:L,defaultExpands:p,visible:D,defaultVisible:ne,placeholder:Z,multiple:a=!1,searchable:j=!1,searchValue:E,defaultSearchValue:H,onlyLeafSelectable:N=!0,showLine:Q=!1,clearable:X=!1,loading:R=!1,size:ce,disabled:ee=!1,virtual:C=!1,escClosable:te=!0,customItem:re,customSelected:k,customSearch:y,inputProps:i,popupRender:O,onModelChange:u,onFirstExpand:T,onExpandsChange:M,onVisibleChange:m,onSearch:P,onClear:b,afterVisibleChange:se,onScrollBottom:Je,...v}=at("TreeSelect",B),V=dt(),h=ut(Ft,{"tree-select":_==null?void 0:_["tree-select"],tree:_==null?void 0:_.tree,"tree-select-popup":_==null?void 0:_["tree-select-popup"]},Se),Re=f.useRef(new Set),{t:Te}=pt(),Me=f.useId(),Ee=`${V}-tree-select-list-${Me}`,ke=e=>`${V}-tree-select-item-${e}-${Me}`,{contentResizeRef:Ye}=ft(),G=f.useRef(null),w=f.useRef(null),oe=f.useRef(null),q=f.useRef(null),[ie,F]=f.useMemo(()=>{const e=J.map(l=>a?new Rt(l,c=>c.value,{disabled:l.disabled}):new Tt(l,c=>c.value,{disabled:l.disabled})),t=new Map,s=l=>{for(const c of l)t.set(c.id,c),c.children&&s(c.children)};return s(e),[e,t]},[J,a]),[x,A]=xe(ne??!1,D,m),[de,Ze]=xe(H??"",E,P),[ue,K]=xe(Y??(a?[]:null),z,e=>{u&&(a?u(e,e.map(t=>F.get(t).origin)):u(e,$.isNull(e)?null:F.get(e).origin))},void 0,d==null?void 0:d.control),S=f.useMemo(()=>a?new Set(ue):ue,[ue,a]),Ae=e=>{if(a){const t=e.changeStatus(e.checked?"UNCHECKED":"CHECKED",S);K(Array.from(t.keys()))}else(e.isLeaf||!N)&&(K(e.id),A(!1))},We=e=>{if(a){const t=e[I].changeStatus(e[I].checked?"UNCHECKED":"CHECKED",S);K(Array.from(t.keys()))}else K(e[I].id),A(!1)};F.forEach(e=>{e.updateStatus(S)});const[ze,Le]=xe(p??[],L,e=>{M&&M(e,e.map(t=>F.get(t).origin))}),pe=f.useMemo(()=>new Set(ze),[ze]),{size:ye,disabled:le}=ht({size:ce,disabled:ee||(d==null?void 0:d.control.disabled)}),W=de.length>0,fe=a?S.size>0:!$.isNull(S),he=(()=>{if(!W)return[];const e=$.isUndefined(y==null?void 0:y.filter)?c=>c.label.includes(de):c=>y.filter(de,c),t=y==null?void 0:y.sort,s=[],l=c=>{c.forEach(o=>{(!a&&!N||o.isLeaf)&&e(o.origin)&&s.push({label:Ne(o),value:o.id,disabled:o.disabled,[I]:o}),o.children&&l(o.children)})};return l(ie),t&&s.sort((c,o)=>t(c[I].origin,o[I].origin)),s})(),He=W?he.length===0:ie.length===0,[Ve,we]=mt(e=>e.startsWith("Arrow")||["Home","End","Enter","Space"].includes(e)),[Fe,Ke]=f.useState(),je=(()=>{let e;return Fe&&(e=F.get(Fe.id),e&&e.enabled)||(fe&&(e=_e(ie,t=>t.enabled&&t.checked,t=>pe.has(t.id)&&t.children)),$.isUndefined(e)&&(e=_e(ie,t=>t.enabled,t=>pe.has(t.id)&&t.children))),e})(),[Ce,Ue]=f.useState(),Ie=(()=>{if(Ce&&_e(he,e=>e[I].enabled&&e.value===Ce.value))return Ce;if(W)return _e(he,e=>e[I].enabled)})(),Qe=bt(x),Xe=`calc(var(--${V}-zindex-fixed) + ${Qe})`,U=qe(()=>{if(x&&G.current&&w.current){const e=G.current.offsetWidth,t=w.current.offsetHeight,s=xt.windowSize.width-Be*2,l=Math.min(w.current.scrollWidth,s),c=_t(G.current,{width:l,height:t},{placement:"bottom-left",inWindow:Be});w.current.style.setProperty("--popup-down-transform-origin",c.transformOrigin),w.current.style.top=c.top+"px",w.current.style.left=c.left+"px",w.current.style.minWidth=Math.min(e,s)+"px",w.current.style.maxWidth=s+"px"}});gt(G,U,!x),De(G,U,void 0,!x),De(w,U,void 0,!x),De(Ye,U,void 0,!x),f.useImperativeHandle(r,()=>({updatePosition:U}),[U]);const me=e=>{document.activeElement===oe.current&&e.target!==oe.current&&e.button===0&&e.preventDefault()},et=e=>{const t=pe.has(e.id);e.origin.loading||(t?Le(s=>{s.splice(s.findIndex(l=>l===e.id),1)}):(Re.current.has(e.id)||(Re.current.add(e.id),T==null||T(e.id,e.origin)),Le(s=>{s.push(e.id)})))},ae=f.useRef(()=>{}),be=j&&x,$e=X&&fe&&!x&&!R&&!le,[tt,rt,st]=(()=>{let e=null,t=null,s;if(a){const l=ue.map(c=>{const o=F.get(c);return{value:c,label:k?k(c,o==null?void 0:o.origin):o?o.origin.label:String(c),node:o}});t=n.jsx(vt,{list:l.map(({value:c,label:o,node:g})=>({id:c,title:o,type:"item",disabled:g==null?void 0:g.origin.disabled})),virtual:C,onClick:c=>(K(o=>{o.splice(o.findIndex(g=>g===c),1)}),!1),children:c=>n.jsx(Ge,{...c,tabIndex:-1,size:ye,children:S.size})}),e=l.map(({value:c,label:o,node:g})=>n.jsxs(Ge,{size:ye,children:[o,!(g!=null&&g.disabled||le)&&n.jsx("div",{...h("tree-select__close"),role:"button","aria-label":Te("Close"),onClick:nt=>{nt.stopPropagation();const ct=g.changeStatus("UNCHECKED",S);K(Array.from(ct.keys()))},children:n.jsx(ge,{children:n.jsx(St,{})})})]},c))}else if(!$.isNull(S)){const l=F.get(S);e=s=k?k(S,l==null?void 0:l.origin):l?Ne(l):String(S)}return[e,t,s]})(),lt=Et({compose:{disabled:le},form:d});return n.jsxs(n.Fragment,{children:[n.jsxs("div",{...v,...ve(h("tree-select",`tree-select--${ye}`,{"tree-select.is-expanded":x,"tree-select.is-disabled":le}),{className:v.className,style:v.style}),...lt,ref:e=>(G.current=e,()=>{G.current=null}),onMouseDown:e=>{var t;(t=v.onMouseDown)==null||t.call(v,e),me(e)},onMouseUp:e=>{var t;(t=v.onMouseUp)==null||t.call(v,e),me(e)},onClick:e=>{var t,s;(t=v.onClick)==null||t.call(v,e),(s=oe.current)==null||s.focus({preventScroll:!0}),A(l=>j?!0:!l)},children:[n.jsxs("div",{...h("tree-select__container"),title:st,children:[(()=>{const e=Object.assign({...i,...ve(h("tree-select__search"),{style:{opacity:be?void 0:0,zIndex:be?void 0:-1}}),...d==null?void 0:d.inputAria,ref:t=>{oe.current=t;const s=jt(i==null?void 0:i.ref,t);return()=>{oe.current=null,s()}},tabIndex:le?-1:0,role:"combobox","aria-haspopup":"listbox","aria-expanded":x,"aria-controls":Ee,onFocus:t=>{var s;(s=i==null?void 0:i.onFocus)==null||s.call(i,t),we.onFocus(t)},onBlur:t=>{var s;(s=i==null?void 0:i.onBlur)==null||s.call(i,t),we.onBlur(t),A(!1)},onKeyDown:t=>{var s;if((s=i==null?void 0:i.onKeyDown)==null||s.call(i,t),we.onKeyDown(t),t.code==="Escape")x&&te&&(t.stopPropagation(),t.preventDefault(),A(!1));else{const l=c=>{if(q.current){const o=q.current(c);o&&(W?Ue(o):Ke(o),C===!1&&!c.includes("level")&&(ae.current=()=>{ae.current=()=>{};const g=document.getElementById(ke(W?o.value:o.id));g&&q.current(g)},x&&ae.current()))}};if(x)switch(t.code){case"ArrowUp":{t.preventDefault(),l("prev");break}case"ArrowDown":{t.preventDefault(),l("next");break}case"ArrowLeft":{W||(t.preventDefault(),l("prev-level"));break}case"ArrowRight":{W||(t.preventDefault(),l("next-level"));break}case"Home":{t.preventDefault(),l("first");break}case"End":{t.preventDefault(),l("last");break}default:{(t.code==="Enter"||t.code==="Space"&&!j)&&(t.preventDefault(),W?Ie&&We(Ie):je&&Ae(je));break}}else if(!(j&&["Home","End","Enter","Space"].includes(t.code)))switch(t.code){case"End":case"ArrowUp":{t.preventDefault(),A(!0),l("last");break}case"Home":case"ArrowDown":{t.preventDefault(),A(!0),l("first");break}case"Enter":case"Space":{t.preventDefault(),A(!0);break}default:{Wt(t.key)&&A(!0);break}}}}},j?{type:"text",value:de,autoComplete:"off",disabled:le,onValueChange:t=>{Ze(t)}}:{});return j?n.jsx(zt,{...e}):n.jsx("div",{...e})})(),!be&&(fe?n.jsx("div",{...h("tree-select__content"),children:tt}):Z?n.jsx("div",{...h("tree-select__placeholder-wrapper"),children:n.jsx("div",{...h("tree-select__placeholder"),children:Z})}):null)]}),a&&n.jsx("div",{...h("tree-select__multiple-count"),onClick:e=>{e.stopPropagation()},children:rt}),$e&&n.jsx("div",{...h("tree-select__clear"),role:"button","aria-label":Te("Clear"),onClick:e=>{e.stopPropagation(),b==null||b(),K(a?[]:null)},children:n.jsx(ge,{children:n.jsx(Ct,{})})}),n.jsx("div",{...ve(h("tree-select__icon"),{style:{visibility:$e?"hidden":void 0}}),children:n.jsx(ge,{children:R?n.jsx(Oe,{}):be?n.jsx(Dt,{}):n.jsx(It,{...h("tree-select__arrow")})})})]}),n.jsx(kt,{selector:()=>{let e=document.getElementById(`${V}-tree-select-root`);return e||(e=document.createElement("div"),e.id=`${V}-tree-select-root`,document.body.appendChild(e)),e},children:n.jsx(yt,{enter:x,name:`${V}-popup-down`,duration:wt,onSkipEnter:()=>{U(),ae.current()},onBeforeEnter:()=>{U(),ae.current()},onAfterEnter:()=>{se==null||se(!0)},onAfterLeave:()=>{se==null||se(!1)},children:(e,t)=>n.jsx("div",{...ve(h("tree-select-popup"),{style:{zIndex:Xe,...t?{display:"none"}:void 0}}),ref:s=>(w.current=s,e(s),()=>{w.current=null,e(null)}),onMouseDown:s=>{me(s)},onMouseUp:s=>{me(s)},children:(()=>{const s=n.jsxs("div",{...h("tree-select-popup__content"),children:[R&&n.jsx("div",{...h("tree-select-popup__loading",{"tree-select-popup__loading--empty":He}),children:n.jsx(ge,{children:n.jsx(Oe,{})})}),R&&He?null:W?n.jsx(Lt,{ref:l=>(q.current=l,()=>{q.current=null}),namespace:V,styled:h,id:Ee,list:he,customItem:re,itemId:ke,itemFocused:Ie,multiple:a,onlyLeafSelectable:N,virtual:C,focusVisible:Ve,onClick:l=>{Ue(l),We(l)}}):n.jsx(At,{style:{maxHeight:264,padding:"4px 0"},ref:l=>(q.current=l,()=>{q.current=null}),id:Ee,namespace:V,styled:h,list:ie,itemId:ke,itemSelected:!a&&fe?F.get(S):void 0,itemFocused:je,expands:pe,customItem:re,showLine:Q,multiple:a,onlyLeafSelectable:N,disabled:!1,virtual:C===!1?void 0:{listSize:264,listPadding:4,itemSize:$.isNumber(C)?C:32},focusVisible:Ve,onNodeFocus:Ke,onNodeExpand:et,onNodeClick:Ae,onScrollBottom:Je})]});return O?O(s):s})()})})})]})}export{tr as T};
