import{r as s,v as Re,n as Ee,f as Ie,N as k,s as Ye,j as r,I as B,E as Be,u as ze,a as Fe,b as Le,d as $e,w as Oe,e as Ue,l as S,c as je,y as We,H as Ke,g as Je,J as Ge,h as Ze,i as me,L as qe,m as ke,P as Qe,k as Xe,M as ve,B as et,R as tt,W as ye}from"./index-db9b6e2c.js";import{u as Se}from"./useForkRef-10208b79.js";import{u as rt}from"./MdRoute-de4fd4bc.js";import{S as nt}from"./cancel-b7a8c6cc.js";import{d as ct,S as at,T as it,o as st}from"./utils-41180c5f.js";import{S as ot}from"./keyboard_arrow_left-2d8c55e1.js";import{S as lt,a as dt}from"./keyboard_double_arrow_right-004cd234.js";import{B as ut}from"./BaseInput-14b7fbd3.js";const pt=J=>s.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",...J},s.createElement("path",{d:"M20 3h-1V1h-2v2H7V1H5v2H4c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 18H4V10h16v11zm0-13H4V5h16v3z"})),ft=s.forwardRef((J,le)=>{const{styled:x,currentSelected:d,anotherSelected:p,config:G,range:ee,onDateChange:de}=J,R=s.useRef({}),{t:C,lang:f}=Re(),z=Ee(),ue=Ie(()=>window),F=d?k(d):k().set("hour",0).set("minute",0).set("second",0),E=p?k(p):null,[pe,V]=s.useState(F.toDate()),L=k(pe),[_,te]=s.useState(null),T=(o,l)=>{const a=()=>{V(i=>{const b=k(i);return b.set(o,b.get(o)+l).toDate()})};a();const u=()=>{a(),R.current.clearLoop=z.setTimeout(()=>u(),50)};R.current.clearTid=z.setTimeout(()=>u(),400)},$=()=>{var o,l,a,u;(l=(o=R.current).clearLoop)==null||l.call(o),(u=(a=R.current).clearTid)==null||u.call(a)};Ye(ue,"mouseup",$),s.useImperativeHandle(le,()=>V,[]);const O=(o,l)=>({onMouseDown:a=>{a.button===0&&T(o,l)},onTouchStart:()=>{T(o,l)},onTouchEnd:()=>{$()}}),fe=(()=>{const o=L.set("date",1),l=[];let a=[];for(let u=0,i=-o.day();u<7*6;u++,i++)a.push(o.add(i,"day").toDate()),a.length===7&&(l.push(a),a=[]);return l})();return r.jsxs("div",{...x("date-picker__panel"),children:[r.jsxs("div",{...x("date-picker__header"),children:[r.jsx("button",{...x("date-picker__header-button"),...O("year",-1),title:C("DatePicker","Previous year"),children:r.jsx(B,{children:r.jsx(lt,{})})}),r.jsx("button",{...x("date-picker__header-button"),...O("month",-1),title:C("DatePicker","Previous month"),children:r.jsx(B,{children:r.jsx(ot,{})})}),r.jsx("span",{...x("date-picker__header-date"),children:L.format(f==="zh-CN"?"YYYY年 M月":"MMM YYYY")}),r.jsx("button",{...x("date-picker__header-button"),...O("month",1),title:C("DatePicker","Next month"),children:r.jsx(B,{children:r.jsx(Be,{})})}),r.jsx("button",{...x("date-picker__header-button"),...O("year",1),title:C("DatePicker","Next year"),children:r.jsx(B,{children:r.jsx(dt,{})})})]}),r.jsxs("table",{...x("date-picker__table"),children:[r.jsx("thead",{children:r.jsx("tr",{children:k.weekdaysMin().map(o=>r.jsx("th",{children:o},o))})}),r.jsx("tbody",{children:fe.map((o,l)=>r.jsx("tr",{children:o.map((a,u)=>{const i=k(a),{disabled:b=!1}=(G==null?void 0:G(a))??{},v=d&&i.isSame(F,"date"),A=E&&i.isSame(E,"date"),re=!v&&!A&&E&&i.isSame(_,"date"),_e=!v&&!v&&!re&&d&&E&&i.isBetween(F,E,"date"),P=!v&&_&&E&&i.isBetween(_,E,"date");return r.jsx("td",{style:{pointerEvents:b?"none":void 0},onClick:()=>{V(a),de(F.set("year",i.year()).set("month",i.month()).set("date",i.date()).toDate())},onMouseEnter:()=>{var h,m;(m=(h=R.current).clearHoverTid)==null||m.call(h),te(a)},onMouseLeave:()=>{var h,m;(m=(h=R.current).clearHoverTid)==null||m.call(h),R.current.clearHoverTid=z.setTimeout(()=>te(null),50)},children:r.jsx("div",{...x("date-picker__cell",{"date-picker__cell.is-active":ee?A:v,"date-picker__cell.is-hover":re||ee&&v,"date-picker__cell.is-between":_e,"date-picker__cell.is-between-hover":P,"date-picker__cell.is-disabled":b,"date-picker__cell--out-month":i.get("month")!==L.get("month"),"date-picker__cell--today":!v&&!A&&i.isSame(k(),"date")}),children:i.get("date")})},u)})},l))})]})]})}),_t={"date-picker":"^date-picker","date-picker.is-disabled":"is-disabled","date-picker--small":"^date-picker--small","date-picker--medium":"^date-picker--medium","date-picker--large":"^date-picker--large","date-picker__input":"^date-picker__input","date-picker__indicator":"^date-picker__indicator","date-picker__separator":"^date-picker__separator","date-picker__clear":"^date-picker__clear","date-picker__icon":"^date-picker__icon","date-picker-popup":"^date-picker-popup","date-picker__preset":"^date-picker__preset","date-picker__preset-option":"^date-picker__preset-option","date-picker__panel-wrapper":"^date-picker__panel-wrapper","date-picker__panel":"^date-picker__panel","date-picker__header":"^date-picker__header","date-picker__header-button":"^date-picker__header-button","date-picker__header-date":"^date-picker__header-date","date-picker__table":"^date-picker__table","date-picker__cell":"^date-picker__cell","date-picker__cell.is-active":"is-active","date-picker__cell.is-hover":"is-hover","date-picker__cell.is-between":"is-between","date-picker__cell.is-between-hover":"is-between-hover","date-picker__cell.is-disabled":"is-disabled","date-picker__cell--out-month":"^date-picker__cell--out-month","date-picker__cell--today":"^date-picker__cell--today","date-picker__footer":"^date-picker__footer","time-picker__panel":"^time-picker__panel","time-picker__header":"^time-picker__header","time-picker__column":"^time-picker__column","time-picker__cell":"^time-picker__cell","time-picker__cell.is-active":"is-active","time-picker__cell.is-disabled":"is-disabled"},Dt=s.forwardRef((J,le)=>{const{styleOverrides:x,styleProvider:d,formControl:p,model:G,defaultModel:ee,visible:de,defaultVisible:R,placeholder:C,range:f=!1,format:z,order:ue="ascend",clearable:F=!1,size:E,disabled:pe=!1,presetDate:V,config:L,showTime:_=!1,escClosable:te=!0,inputRef:T,inputRender:$,onModelChange:O,onVisibleChange:fe,onClear:o,afterVisibleChange:l,...a}=ze("DatePicker",J),u=Fe(),i=Le(_t,{"date-picker":d==null?void 0:d["date-picker"],"time-picker":d==null?void 0:d["time-picker"],"date-picker-popup":d==null?void 0:d["date-picker-popup"]},x),b=$e(),{t:v}=Re(),A=Oe(),re=Ee(),{contentResizeRef:_e}=Ue(),P=s.useRef(null),h=s.useRef(null),m=s.useRef(null),U=s.useRef(null),Z=s.useRef(null),Te=Se(m,T==null?void 0:T[0]),Pe=Se(U,T==null?void 0:T[1]),ne=s.useRef(null),ce=s.useRef(null),ae=e=>{var n,t;(n=ne.current)==null||n.call(ne,e),(t=ce.current)==null||t.call(ce,e)},c=s.useRef({latestFocused:"start",onceVisible:!1,focusAnother:!1,inputValue:[void 0,void 0],rangeDate:[null,null]}),N=S.isUndefined(z)?_?"YYYY-MM-DD HH:mm:ss":"YYYY-MM-DD":z,ge=e=>st(e,ue,_?void 0:"date"),[w,W]=je(R??!1,de,fe),[H,xe]=rt([!1,!1]);H[0]&&(c.current.latestFocused="start"),H[1]&&(c.current.latestFocused="end");const[q,K]=je(ee??null,G,O,(e,n)=>ct(e,n,N),p==null?void 0:p.control);let[D,j=null]=f?q??[null,null]:[q,null];f&&(S.isNull(q)?[D,j]=c.current.rangeDate:c.current.rangeDate=[null,null]);const ie=[0,1].map(e=>H[e]&&!S.isUndefined(c.current.inputValue[e])?c.current.inputValue[e]:(()=>{const n=e===0?D:j;return S.isNull(n)?"":k(n).format(N)})()),Q=e=>{const n=H.findIndex(t=>t);f?S.isNull(q)?(c.current.rangeDate[n]=e,c.current.rangeDate.every(t=>!S.isNull(t))&&(c.current.focusAnother=ge(c.current.rangeDate),c.current.focusAnother&&c.current.rangeDate.reverse(),c.current.inputValue=[void 0,void 0],K(c.current.rangeDate))):(c.current.inputValue=[void 0,void 0],K(t=>{t[n]=e,c.current.focusAnother=ge(t),c.current.focusAnother&&t.reverse()})):(c.current.inputValue=[void 0,void 0],K(e)),A()},[Me=v("DatePicker",f?"Start date":"Select date"),Ce=v("DatePicker","End date")]=f?C??[]:[C],{size:Ve,disabled:se}=We({size:E,disabled:pe||(p==null?void 0:p.control.disabled)}),Ae=Ke(w),Ne=`calc(var(--${u}-zindex-fixed) + ${Ae})`,he=s.useRef(),I=Je(()=>{if(w&&P.current&&h.current){const e=h.current.offsetHeight,n=tt.windowSize.width-ye*2,t=Math.min(h.current.scrollWidth,n),y=Ge(P.current,{width:t,height:e},{placement:"bottom-left",inWindow:ye});he.current=y.transformOrigin,b.classes.position&&h.current.classList.toggle(b.classes.position,!1),b.replaceRule("position",{top:y.top,left:y.left,maxWidth:n}),h.current.classList.toggle(b.classes.position,!0)}});Ze(P,I,!w),me(P,I,void 0,!w),me(h,I,void 0,!w),me(_e,I,void 0,!w),s.useImperativeHandle(le,()=>({updatePosition:I}),[I]),s.useEffect(()=>{if(P.current&&Z.current){let e=!1;const n=P.current.getBoundingClientRect();if(m.current&&document.activeElement===m.current){const t=m.current.getBoundingClientRect();Z.current.style.cssText=`left:${t.left-n.left}px;width:${t.width}px;opacity:1;`,e=!0}if(U.current&&document.activeElement===U.current){const t=U.current.getBoundingClientRect();Z.current.style.cssText=`left:${t.left-n.left}px;width:${t.width}px;opacity:1;`,e=!0}e||(Z.current.style.cssText+="opacity:0;")}}),s.useEffect(()=>{if(c.current.focusAnother&&document.activeElement){const e=document.activeElement.parentElement;for(let n=0;n<e.childElementCount;n++){const t=e.children.item(n);if(t.tagName.toLowerCase()==="input"&&t!==document.activeElement){t.focus({preventScroll:!0});break}}}c.current.focusAnother=!1});const X=e=>{if(f){const n=H.findIndex(t=>t);S.isNull(n===0?j:D)?(c.current.focusAnother=!0,A()):W(!1)}else W(!1);c.current.focusAnother||ae(e)},be=F&&!S.isNull(q)&&!w&&!se,we=e=>{const n=e?0:1,t=e?D:j,y=$==null?void 0:$[n],M=r.jsx(ut,{...i("date-picker__input"),...p==null?void 0:p.inputAria,ref:e?Te:Pe,type:"text",autoComplete:"off",value:ie[n],size:22,placeholder:e?Me:Ce,disabled:se,onValueChange:g=>{if(A(),c.current.inputValue[n]=g,k(g,N,!0).isValid()){const Y=k(g,N).toDate();Q(Y),ae(Y)}},onKeyDown:g=>{if(g.code==="Escape")w&&te&&(g.stopPropagation(),g.preventDefault(),W(!1));else if(g.code==="Enter"&&ie[n]&&k(ie[n],N,!0).isValid()){g.preventDefault();const Y=k(ie[n],N).toDate();X(Y)}},onFocus:()=>{var g,Y;(Y=(g=c.current).clearTid)==null||Y.call(g),xe(De=>{De.fill(!1),De[e?0:1]=!0}),c.current.inputValue=[void 0,void 0],w&&f&&t&&ae(t)},onBlur:()=>{c.current.clearTid=re.setTimeout(()=>{xe([!1,!1]),W(!1)},20)}});return y?y(M):M},oe=e=>{(document.activeElement===m.current||document.activeElement===U.current)&&e.target!==m.current&&e.target!==U.current&&e.button===0&&e.preventDefault()},He=qe({compose:{disabled:se},form:p});return r.jsxs(r.Fragment,{children:[r.jsxs("div",{...a,...ke(i("date-picker",`date-picker--${Ve}`,{"date-picker.is-disabled":se}),{className:a.className,style:a.style}),...He,ref:P,onMouseDown:e=>{var n;(n=a.onMouseDown)==null||n.call(a,e),oe(e)},onMouseUp:e=>{var n;(n=a.onMouseUp)==null||n.call(a,e),oe(e)},onClick:e=>{var n,t;(n=a.onClick)==null||n.call(a,e),H.some(y=>y)||(t=m.current)==null||t.focus({preventScroll:!0}),W(!0)},children:[we(!0),f&&r.jsxs(r.Fragment,{children:[r.jsx("div",{...i("date-picker__indicator"),ref:Z}),r.jsx("div",{...i("date-picker__separator"),children:r.jsx(B,{children:r.jsx(at,{})})}),we(!1)]}),be&&r.jsx("div",{...i("date-picker__clear"),role:"button","aria-label":v("Clear"),onClick:e=>{e.stopPropagation(),c.current.inputValue=[void 0,void 0],K(null),o==null||o()},children:r.jsx(B,{children:r.jsx(nt,{})})}),r.jsx("div",{...ke(i("date-picker__icon"),{style:{visibility:be?"hidden":void 0}}),children:r.jsx(B,{children:r.jsx(pt,{})})})]}),r.jsx(Qe,{selector:()=>{let e=document.getElementById(`${u}-date-picker-root`);return e||(e=document.createElement("div"),e.id=`${u}-date-picker-root`,document.body.appendChild(e)),e},children:r.jsx(Xe,{enter:w,during:ve,afterRender:()=>{I();const e=()=>{const n=H[0]?D:j;n&&ae(n)};f?e():c.current.onceVisible||(c.current.onceVisible=!0,e())},afterEnter:()=>{l==null||l(!0)},afterLeave:()=>{l==null||l(!1)},children:e=>{let n={};switch(e){case"enter":n={transform:"scaleY(0.7)",opacity:0};break;case"entering":n={transition:["transform","opacity"].map(t=>`${t} ${ve}ms ease-out`).join(", "),transformOrigin:he.current};break;case"leaving":n={transform:"scaleY(0.7)",opacity:0,transition:["transform","opacity"].map(t=>`${t} ${ve}ms ease-in`).join(", "),transformOrigin:he.current};break;case"leaved":n={display:"none"};break}return r.jsxs("div",{...ke(i("date-picker-popup"),{style:{zIndex:Ne,...n}}),ref:h,onMouseDown:t=>{oe(t)},onMouseUp:t=>{oe(t)},children:[V&&r.jsx("ul",{...i("date-picker__preset"),children:Object.keys(V).map(t=>{const y=()=>{const M=V[t]();c.current.inputValue=[void 0,void 0],f?S.isArray(M)?(K(M),W(!1)):(Q(M),X(M)):(K(M),X(M))};return s.createElement("li",{...i("date-picker__preset-option"),key:t,role:"button",onClick:y},t)})}),r.jsxs("div",{...i("date-picker__panel-wrapper"),children:[r.jsx(ft,{ref:ne,styled:i,currentSelected:c.current.latestFocused==="start"?D:j,anotherSelected:c.current.latestFocused==="start"?j:D,config:L?(...t)=>L(...t,c.current.latestFocused,[D,j]):void 0,range:f,onDateChange:t=>{Q(t),_||X(t)}}),_&&r.jsx(it,{ref:ce,styled:i,time:c.current.latestFocused==="start"?D:j,format:N,config:_&&!S.isBoolean(_)&&_.config?(...t)=>_.config(...t,c.current.latestFocused,[D,j]):void 0,inDatePicker:!0,onTimeChange:t=>{Q(t)}}),r.jsx("div",{...i("date-picker__footer"),children:r.jsx(et,{pattern:"link",onClick:()=>{const t=new Date;Q(t),X(t)},children:v("DatePicker",_?"Now":"Today")})})]})]})}})})]})});export{Dt as D};
