import{r as d,f as Oe,E as it,l as T,j as l,u as ot,a as at,b as dt,w as ut,d as pt,c as ne,z as ft,G as _t,H as ce,J as ht,K as mt,h as bt,i as Ee,p as xt,I as ie,M as gt,N as vt,m as oe,q as Ke,P as St,k as kt,O as Et,R as wt,W as Ue}from"./index-a2c2c507.js";import{s as yt}from"./setRef-89151aaa.js";import{S as jt}from"./cancel-b218de5e.js";import{S as Ct}from"./keyboard_arrow_down-be4aa932.js";import{S as It}from"./search-6b19cf11.js";import{g as we}from"./utils-c2ed83c6.js";import{T as w,M as Dt,S as Nt}from"./single-node-19c90d0d.js";import{V as Rt}from"./VirtualScroll-abcdf3ee.js";import{C as Tt}from"./Checkbox-96c4a68e.js";import{E as Be}from"./Empty-007e0abb.js";import{T as Mt}from"./TreePanel-d916a346.js";import{T as $e}from"./Tag-4e7d6b1f.js";import{i as At}from"./isPrintableCharacter-1b5c27a6.js";import{B as Wt}from"./BaseInput-598612fc.js";function zt(ae){const{ref:de,namespace:ue,styled:_,id:x,list:L,customItem:G,itemId:q,itemFocused:E,multiple:B,onlyLeafSelectable:pe,virtual:H,focusVisible:J,onClick:a}=ae,u=d.useRef(null),C=d.useRef(null),Y=Oe(i=>{var M,S,h,A;if(u.current){let p;switch(i){case"next":p=(M=C.current)==null?void 0:M.scrollToStep(u.current,1);break;case"prev":p=(S=C.current)==null?void 0:S.scrollToStep(u.current,-1);break;case"first":p=(h=C.current)==null?void 0:h.scrollToStart(u.current);break;case"last":p=(A=C.current)==null?void 0:A.scrollToEnd(u.current);break;default:i instanceof HTMLElement&&u.current&&it(i,u.current);break}return p}});d.useImperativeHandle(de,()=>Y,[Y]);const V=d.useMemo(()=>({list:L,itemKey:i=>i.value,itemSize:T.isNumber(H)?H:32,itemFocusable:i=>i[w].enabled}),[L,H]);return l.jsx(Rt,{...V,ref:i=>(C.current=i,()=>{C.current=null}),enable:H!==!1,listSize:264,listPadding:4,itemRender:(i,M,S)=>{const h=i[w];let A=h.checked;if(!pe){let p=h;for(;p.parent;)if(p=p.parent,p.id===i.value){A=!0;break}}return d.createElement("li",{..._("tree__option",{"tree__option.is-selected":!B&&A,"tree__option.is-disabled":h.disabled}),...S,key:i.value,id:q(i.value),title:i.label,role:"option","aria-selected":h.checked,"aria-disabled":h.disabled,onClick:()=>{a(i)}},J&&(E==null?void 0:E.value)===i.value&&l.jsx("div",{className:`${ue}-focus-outline`}),B&&l.jsx("div",{..._("tree__option-checkbox"),children:l.jsx(Tt,{model:h.checked,disabled:h.disabled})}),l.jsx("div",{..._("tree__option-content"),children:G?G(h.origin):we(h)}))},itemFocused:E==null?void 0:E.value,placeholder:"li",children:(i,M)=>l.jsx("ul",{..._("tree"),ref:S=>(u.current=S,()=>{u.current=null}),id:x,tabIndex:-1,role:"listbox","aria-multiselectable":B,"aria-activedescendant":T.isUndefined(E)?void 0:q(E.value),onScroll:M,children:L.length===0?l.jsx(Be,{style:{padding:"12px 28px"},image:Be.SIMPLE_IMG}):i})})}const Ft={"tree-select":"^tree-select","tree-select.is-expanded":"is-expanded","tree-select.is-disabled":"is-disabled","tree-select--small":"^tree-select--small","tree-select--medium":"^tree-select--medium","tree-select--large":"^tree-select--large","tree-select__container":"^tree-select__container","tree-select__content":"^tree-select__content","tree-select__search":"^tree-select__search","tree-select__placeholder-wrapper":"^tree-select__placeholder-wrapper","tree-select__placeholder":"^tree-select__placeholder","tree-select__multiple-count":"^tree-select__multiple-count","tree-select__close":"^tree-select__close","tree-select__clear":"^tree-select__clear","tree-select__icon":"^tree-select__icon","tree-select__arrow":"^tree-select__arrow","tree-select-popup":"^tree-select-popup","tree-select-popup__content":"^tree-select-popup__content","tree-select-popup__loading":"^tree-select-popup__loading","tree-select-popup__loading--empty":"^tree-select-popup__loading--empty",tree:"^tree","tree--line":"^tree--line",tree__group:"^tree__group","tree__group--root":"^tree__group--root",tree__option:"^tree__option","tree__option.is-selected":"is-selected","tree__option.is-disabled":"is-disabled","tree__option--root":"^tree__option--root","tree__option--first":"^tree__option--first","tree__option-dot":"^tree__option-dot","tree__option-icon":"^tree__option-icon","tree__option-arrow":"^tree__option-arrow","tree__option-arrow.is-expand":"is-expand","tree__option-checkbox":"^tree__option-checkbox","tree__option-content":"^tree__option-content",tree__empty:"^tree__empty"};function Qt(ae){const{ref:de,styleOverrides:ue,styleProvider:_,formControl:x,list:L,model:G,defaultModel:q,expands:E,defaultExpands:B,visible:pe,defaultVisible:H,placeholder:J,multiple:a=!1,searchable:u=!1,searchValue:C,defaultSearchValue:Y,onlyLeafSelectable:V=!0,showLine:i=!1,clearable:M=!1,loading:S=!1,size:h,disabled:A=!1,virtual:p=!1,escClosable:Pe=!0,customItem:ye,customSelected:Z,customSearch:W,inputProps:o,popupRender:je,onModelChange:fe,onFirstExpand:_e,onExpandsChange:Ce,onVisibleChange:Ge,onSearch:qe,onClear:he,afterVisibleChange:K,onScrollBottom:Je,...g}=ot("TreeSelect",ae),I=at(),f=dt(Ft,{"tree-select":_==null?void 0:_["tree-select"],tree:_==null?void 0:_.tree,"tree-select-popup":_==null?void 0:_["tree-select-popup"]},ue),Ie=d.useRef(new Set),{t:De}=ut(),Ne=d.useId(),me=`${I}-tree-select-list-${Ne}`,be=e=>`${I}-tree-select-item-${e}-${Ne}`,{contentResizeRef:Ye}=pt(),z=d.useRef(null),k=d.useRef(null),$=d.useRef(null),F=d.useRef(null),[O,D]=d.useMemo(()=>{const e=L.map(s=>a?new Dt(s,n=>n.value,{disabled:s.disabled}):new Nt(s,n=>n.value,{disabled:s.disabled})),t=new Map,r=s=>{for(const n of s)t.set(n.id,n),n.children&&r(n.children)};return r(e),[e,t]},[L,a]),[m,y]=ne(H??!1,pe,Ge),[Q,Ze]=ne(Y??"",C,qe),[X,N]=ne(q??(a?[]:null),G,e=>{fe&&(a?fe(e,e.map(t=>D.get(t).origin)):fe(e,T.isNull(e)?null:D.get(e).origin))},void 0,x==null?void 0:x.control),v=d.useMemo(()=>a?new Set(X):X,[X,a]),Re=e=>{if(a){const t=e.changeStatus(e.checked?"UNCHECKED":"CHECKED",v);N(Array.from(t.keys()))}else(e.isLeaf||!V)&&(N(e.id),y(!1))},Te=e=>{if(a){const t=e[w].changeStatus(e[w].checked?"UNCHECKED":"CHECKED",v);N(Array.from(t.keys()))}else N(e[w].id),y(!1)};D.forEach(e=>{e.updateStatus(v)});const[Me,Ae]=ne(B??[],E,e=>{Ce&&Ce(e,e.map(t=>D.get(t).origin))}),ee=d.useMemo(()=>new Set(Me),[Me]),{size:xe,disabled:U}=ft({size:h,disabled:A||(x==null?void 0:x.control.disabled)}),j=Q.length>0,te=a?v.size>0:!T.isNull(v),re=(()=>{if(!j)return[];const e=T.isUndefined(W==null?void 0:W.filter)?n=>n.label.includes(Q):n=>W.filter(Q,n),t=W==null?void 0:W.sort,r=[],s=n=>{n.forEach(c=>{(!a&&!V||c.isLeaf)&&e(c.origin)&&r.push({label:we(c),value:c.id,disabled:c.disabled,[w]:c}),c.children&&s(c.children)})};return s(O),t&&r.sort((n,c)=>t(n[w].origin,c[w].origin)),r})(),We=j?re.length===0:O.length===0,[ze,ge]=_t(e=>e.startsWith("Arrow")||["Home","End","Enter","Space"].includes(e)),[Fe,Le]=d.useState(),ve=(()=>{let e;return Fe&&(e=D.get(Fe.id),e&&e.enabled)||(te&&(e=ce(O,t=>t.enabled&&t.checked,t=>ee.has(t.id)&&t.children)),T.isUndefined(e)&&(e=ce(O,t=>t.enabled,t=>ee.has(t.id)&&t.children))),e})(),[Se,He]=d.useState(),ke=(()=>{if(Se&&ce(re,e=>e[w].enabled&&e.value===Se.value))return Se;if(j)return ce(re,e=>e[w].enabled)})(),Qe=ht(m),Xe=`calc(var(--${I}-zindex-fixed) + ${Qe})`,R=Oe(()=>{if(m&&z.current&&k.current){const e=z.current.offsetWidth,t=k.current.offsetHeight,r=wt.windowSize.width-Ue*2,s=Math.min(k.current.scrollWidth,r),n=mt(z.current,{width:s,height:t},{placement:"bottom-left",inWindow:Ue});k.current.style.setProperty("--popup-down-transform-origin",n.transformOrigin),k.current.style.top=n.top+"px",k.current.style.left=n.left+"px",k.current.style.minWidth=Math.min(e,r)+"px",k.current.style.maxWidth=r+"px"}});bt(z,R,!m),Ee(z,R,void 0,!m),Ee(k,R,void 0,!m),Ee(Ye,R,void 0,!m),d.useImperativeHandle(de,()=>({updatePosition:R}),[R]);const se=e=>{document.activeElement===$.current&&e.target!==$.current&&e.button===0&&e.preventDefault()},et=e=>{const t=ee.has(e.id);e.origin.loading||(t?Ae(r=>{r.splice(r.findIndex(s=>s===e.id),1)}):(Ie.current.has(e.id)||(Ie.current.add(e.id),_e==null||_e(e.id,e.origin)),Ae(r=>{r.push(e.id)})))},P=d.useRef(()=>{}),le=u&&m,Ve=M&&te&&!m&&!S&&!U,[tt,rt,st]=(()=>{let e=null,t=null,r;if(a){const s=X.map(n=>{const c=D.get(n);return{value:n,label:Z?Z(n,c==null?void 0:c.origin):c?c.origin.label:String(n),node:c}});t=l.jsx(xt,{list:s.map(({value:n,label:c,node:b})=>({id:n,title:c,type:"item",disabled:b==null?void 0:b.origin.disabled})),onClick:n=>(N(c=>{c.splice(c.findIndex(b=>b===n),1)}),!1),children:n=>l.jsx($e,{...n,tabIndex:-1,size:xe,children:v.size})}),e=s.map(({value:n,label:c,node:b})=>l.jsxs($e,{size:xe,children:[c,!(b!=null&&b.disabled||U)&&l.jsx("div",{...f("tree-select__close"),role:"button","aria-label":De("Close"),onClick:nt=>{nt.stopPropagation();const ct=b.changeStatus("UNCHECKED",v);N(Array.from(ct.keys()))},children:l.jsx(ie,{children:l.jsx(gt,{})})})]},n))}else if(!T.isNull(v)){const s=D.get(v);e=r=Z?Z(v,s==null?void 0:s.origin):s?we(s):String(v)}return[e,t,r]})(),lt=vt({compose:{disabled:U},form:x});return l.jsxs(l.Fragment,{children:[l.jsxs("div",{...g,...oe(f("tree-select",`tree-select--${xe}`,{"tree-select.is-expanded":m,"tree-select.is-disabled":U}),{className:g.className,style:g.style}),...lt,ref:e=>(z.current=e,()=>{z.current=null}),onMouseDown:e=>{var t;(t=g.onMouseDown)==null||t.call(g,e),se(e)},onMouseUp:e=>{var t;(t=g.onMouseUp)==null||t.call(g,e),se(e)},onClick:e=>{var t,r;(t=g.onClick)==null||t.call(g,e),(r=$.current)==null||r.focus({preventScroll:!0}),y(s=>u?!0:!s)},children:[l.jsxs("div",{...f("tree-select__container"),title:st,children:[(()=>{const e=Object.assign({...o,...oe(f("tree-select__search"),{style:{opacity:le?void 0:0,zIndex:le?void 0:-1}}),...x==null?void 0:x.inputAria,ref:t=>{$.current=t;const r=yt(o==null?void 0:o.ref,t);return()=>{$.current=null,r()}},tabIndex:U?-1:0,role:"combobox","aria-haspopup":"listbox","aria-expanded":m,"aria-controls":me,onFocus:t=>{var r;(r=o==null?void 0:o.onFocus)==null||r.call(o,t),ge.onFocus(t)},onBlur:t=>{var r;(r=o==null?void 0:o.onBlur)==null||r.call(o,t),ge.onBlur(t),y(!1)},onKeyDown:t=>{var r;if((r=o==null?void 0:o.onKeyDown)==null||r.call(o,t),ge.onKeyDown(t),t.code==="Escape")m&&Pe&&(t.stopPropagation(),t.preventDefault(),y(!1));else{const s=n=>{if(F.current){const c=F.current(n);c&&(j?He(c):Le(c),p===!1&&!n.includes("level")&&(P.current=()=>{P.current=()=>{};const b=document.getElementById(be(j?c.value:c.id));b&&F.current(b)},m&&P.current()))}};if(m)switch(t.code){case"ArrowUp":{t.preventDefault(),s("prev");break}case"ArrowDown":{t.preventDefault(),s("next");break}case"ArrowLeft":{j||(t.preventDefault(),s("prev-level"));break}case"ArrowRight":{j||(t.preventDefault(),s("next-level"));break}case"Home":{t.preventDefault(),s("first");break}case"End":{t.preventDefault(),s("last");break}default:{(t.code==="Enter"||t.code==="Space"&&!u)&&(t.preventDefault(),j?ke&&Te(ke):ve&&Re(ve));break}}else if(!(u&&["Home","End","Enter","Space"].includes(t.code)))switch(t.code){case"End":case"ArrowUp":{t.preventDefault(),y(!0),s("last");break}case"Home":case"ArrowDown":{t.preventDefault(),y(!0),s("first");break}case"Enter":case"Space":{t.preventDefault(),y(!0);break}default:{At(t.key)&&y(!0);break}}}}},u?{type:"text",value:Q,autoComplete:"off",disabled:U,onValueChange:t=>{Ze(t)}}:{});return u?l.jsx(Wt,{...e}):l.jsx("div",{...e})})(),!le&&(te?l.jsx("div",{...f("tree-select__content"),children:tt}):J?l.jsx("div",{...f("tree-select__placeholder-wrapper"),children:l.jsx("div",{...f("tree-select__placeholder"),children:J})}):null)]}),a&&l.jsx("div",{...f("tree-select__multiple-count"),onClick:e=>{e.stopPropagation()},children:rt}),Ve&&l.jsx("div",{...f("tree-select__clear"),role:"button","aria-label":De("Clear"),onClick:e=>{e.stopPropagation(),he==null||he(),N(a?[]:null)},children:l.jsx(ie,{children:l.jsx(jt,{})})}),l.jsx("div",{...oe(f("tree-select__icon"),{style:{visibility:Ve?"hidden":void 0}}),children:l.jsx(ie,{children:S?l.jsx(Ke,{}):le?l.jsx(It,{}):l.jsx(Ct,{...f("tree-select__arrow")})})})]}),l.jsx(St,{selector:()=>{let e=document.getElementById(`${I}-tree-select-root`);return e||(e=document.createElement("div"),e.id=`${I}-tree-select-root`,document.body.appendChild(e)),e},children:l.jsx(kt,{enter:m,name:`${I}-popup-down`,duration:Et,onSkipEnter:()=>{R(),P.current()},onBeforeEnter:()=>{R(),P.current()},onAfterEnter:()=>{K==null||K(!0)},onAfterLeave:()=>{K==null||K(!1)},children:(e,t)=>l.jsx("div",{...oe(f("tree-select-popup"),{style:{zIndex:Xe,...t?{display:"none"}:void 0}}),ref:r=>(k.current=r,e(r),()=>{k.current=null,e(null)}),onMouseDown:r=>{se(r)},onMouseUp:r=>{se(r)},children:(()=>{const r=l.jsxs("div",{...f("tree-select-popup__content"),children:[S&&l.jsx("div",{...f("tree-select-popup__loading",{"tree-select-popup__loading--empty":We}),children:l.jsx(ie,{children:l.jsx(Ke,{})})}),S&&We?null:j?l.jsx(zt,{ref:s=>(F.current=s,()=>{F.current=null}),namespace:I,styled:f,id:me,list:re,customItem:ye,itemId:be,itemFocused:ke,multiple:a,onlyLeafSelectable:V,virtual:p,focusVisible:ze,onClick:s=>{He(s),Te(s)}}):l.jsx(Mt,{style:{maxHeight:264,padding:"4px 0"},ref:s=>(F.current=s,()=>{F.current=null}),id:me,namespace:I,styled:f,list:O,itemId:be,itemSelected:!a&&te?D.get(v):void 0,itemFocused:ve,expands:ee,customItem:ye,showLine:i,multiple:a,onlyLeafSelectable:V,disabled:!1,virtual:p===!1?void 0:{listSize:264,listPadding:4,itemSize:T.isNumber(p)?p:32},focusVisible:ze,onNodeFocus:Le,onNodeExpand:et,onNodeClick:Re,onScrollBottom:Je})]});return je?je(r):r})()})})})]})}export{Qt as T};
