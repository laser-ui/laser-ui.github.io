import{r as n,g as Ye,A as _t,l as C,j as s,u as ht,a as mt,b as bt,d as gt,v as xt,e as vt,c as le,x as St,F as kt,G as ne,H as Et,R as wt,W as Ke,J as yt,h as jt,i as Ct,k as we,m as oe,p as Rt,I as ce,K as It,L as Dt,q as Oe,P as Nt,n as Tt,M as ye}from"./index-92d57a43.js";import{u as Mt}from"./useForkRef-dbbb7b53.js";import{S as Lt}from"./cancel-e1e62cb0.js";import{S as Pt}from"./keyboard_arrow_down-fc661264.js";import{S as At}from"./search-a3c8a8fe.js";import{g as ae}from"./utils-c2ed83c6.js";import{T as v,M as Wt,S as Ft}from"./single-node-19c90d0d.js";import{V as zt}from"./VirtualScroll-a48ccf4e.js";import{C as Ht}from"./Checkbox-5d0f3590.js";import{E as Be}from"./Empty-97e33c23.js";import{T as $t}from"./TreePanel-b48e17ce.js";import{i as Ut}from"./isPrintableCharacter-1b5c27a6.js";import{T as Ge}from"./Tag-9cb0f6ac.js";function Vt(de,ue){const{namespace:pe,styled:_,id:m,list:P,customItem:B,itemId:G,itemFocused:x,multiple:$,onlyLeafSelectable:fe,virtual:A,focusVisible:Y,onClick:a}=de,d=n.useRef(null),R=n.useRef(null),q=Ye(o=>{var I,S,h,D;if(d.current){let u;switch(o){case"next":u=(I=R.current)==null?void 0:I.scrollToStep(d.current,1);break;case"prev":u=(S=R.current)==null?void 0:S.scrollToStep(d.current,-1);break;case"first":u=(h=R.current)==null?void 0:h.scrollToStart(d.current);break;case"last":u=(D=R.current)==null?void 0:D.scrollToEnd(d.current);break;default:o instanceof HTMLElement&&d.current&&_t(o,d.current);break}return u}});n.useImperativeHandle(ue,()=>q,[q]);const W=n.useMemo(()=>({list:P,itemKey:o=>o.value,itemSize:C.isNumber(A)?A:32,itemFocusable:o=>o[v].enabled}),[P,A]);return s.jsx(zt,{...W,ref:R,enable:A!==!1,listSize:264,listPadding:4,itemRender:(o,I,S)=>{const h=o[v];let D=h.checked;if(!fe){let u=h;for(;u.parent;)if(u=u.parent,u.id===o.value){D=!0;break}}return n.createElement("li",{..._("tree__option",{"tree__option.is-selected":!$&&D,"tree__option.is-disabled":h.disabled}),...S,key:o.value,id:G(o.value),title:o.label,role:"option","aria-selected":h.checked,"aria-disabled":h.disabled,onClick:()=>{a(o)}},Y&&(x==null?void 0:x.value)===o.value&&s.jsx("div",{className:`${pe}-focus-outline`}),$&&s.jsx("div",{..._("tree__option-checkbox"),children:s.jsx(Ht,{model:h.checked,disabled:h.disabled})}),s.jsx("div",{..._("tree__option-content"),children:B?B(h.origin):ae(h)}))},itemFocused:x==null?void 0:x.value,placeholder:"li",children:(o,I)=>s.jsx("ul",{..._("tree"),ref:d,id:m,tabIndex:-1,role:"listbox","aria-multiselectable":$,"aria-activedescendant":C.isUndefined(x)?void 0:G(x.value),onScroll:I,children:P.length===0?s.jsx(Be,{style:{padding:"12px 28px"},image:Be.SIMPLE_IMG}):o})})}const Kt=n.forwardRef(Vt),Ot={"tree-select":"^tree-select","tree-select.is-expanded":"is-expanded","tree-select.is-disabled":"is-disabled","tree-select--small":"^tree-select--small","tree-select--medium":"^tree-select--medium","tree-select--large":"^tree-select--large","tree-select__container":"^tree-select__container","tree-select__content":"^tree-select__content","tree-select__search":"^tree-select__search","tree-select__placeholder-wrapper":"^tree-select__placeholder-wrapper","tree-select__placeholder":"^tree-select__placeholder","tree-select__multiple-count":"^tree-select__multiple-count","tree-select__close":"^tree-select__close","tree-select__clear":"^tree-select__clear","tree-select__icon":"^tree-select__icon","tree-select__arrow":"^tree-select__arrow","tree-select-popup":"^tree-select-popup","tree-select-popup__content":"^tree-select-popup__content","tree-select-popup__loading":"^tree-select-popup__loading","tree-select-popup__loading--empty":"^tree-select-popup__loading--empty",tree:"^tree","tree--line":"^tree--line",tree__group:"^tree__group","tree__group--root":"^tree__group--root",tree__option:"^tree__option","tree__option.is-selected":"is-selected","tree__option.is-disabled":"is-disabled","tree__option--root":"^tree__option--root","tree__option--first":"^tree__option--first","tree__option-dot":"^tree__option-dot","tree__option-icon":"^tree__option-icon","tree__option-arrow":"^tree__option-arrow","tree__option-arrow.is-expand":"is-expand","tree__option-checkbox":"^tree__option-checkbox","tree__option-content":"^tree__option-content",tree__empty:"^tree__empty"};function Bt(de,ue){const{styleOverrides:pe,styleProvider:_,formControl:m,list:P,model:B,defaultModel:G,expands:x,defaultExpands:$,visible:fe,defaultVisible:A,placeholder:Y,multiple:a=!1,searchable:d=!1,searchValue:R,defaultSearchValue:q,onlyLeafSelectable:W=!0,showLine:o=!1,clearable:I=!1,loading:S=!1,size:h,disabled:D=!1,virtual:u=!1,escClosable:qe=!0,customItem:je,customSelected:F,customSearch:N,inputRef:Je,inputRender:Ce,popupRender:Re,onModelChange:_e,onFirstExpand:he,onExpandsChange:Ie,onVisibleChange:Ze,onSearch:Qe,onClear:me,afterVisibleChange:z,onScrollBottom:Xe,...b}=ht("TreeSelect",de),T=mt(),p=bt(Ot,{"tree-select":_==null?void 0:_["tree-select"],tree:_==null?void 0:_.tree,"tree-select-popup":_==null?void 0:_["tree-select-popup"]},pe),J=gt(),De=n.useRef({expands:new Set}),{t:Ne}=xt(),Te=n.useId(),be=`${T}-tree-select-list-${Te}`,ge=e=>`${T}-tree-select-item-${e}-${Te}`,{pageScrollRef:et,contentResizeRef:tt}=vt(),U=n.useRef(null),M=n.useRef(null),Z=n.useRef(null),st=Mt(Z,Je),V=n.useRef(null),[K,w]=n.useMemo(()=>{const e=P.map(l=>a?new Wt(l,r=>r.value,{disabled:l.disabled}):new Ft(l,r=>r.value,{disabled:l.disabled})),t=new Map,i=l=>{for(const r of l)t.set(r.id,r),r.children&&i(r.children)};return i(e),[e,t]},[P,a]),[f,k]=le(A??!1,fe,Ze),[Q,rt]=le(q??"",R,Qe),[X,y]=le(G??(a?[]:null),B,e=>{_e&&(a?_e(e,e.map(t=>w.get(t).origin)):_e(e,C.isNull(e)?null:w.get(e).origin))},void 0,m==null?void 0:m.control),g=n.useMemo(()=>a?new Set(X):X,[X,a]),Me=e=>{if(a){const t=e.changeStatus(e.checked?"UNCHECKED":"CHECKED",g);y(Array.from(t.keys()))}else(e.isLeaf||!W)&&y(e.id),e.isLeaf&&k(!1)},Le=e=>{if(a){const t=e[v].changeStatus(e[v].checked?"UNCHECKED":"CHECKED",g);y(Array.from(t.keys()))}else y(e[v].id),k(!1)};w.forEach(e=>{e.updateStatus(g)});const[Pe,Ae]=le($??[],x,e=>{Ie&&Ie(e,e.map(t=>w.get(t).origin))}),ee=n.useMemo(()=>new Set(Pe),[Pe]),{size:xe,disabled:H}=St({size:h,disabled:D||(m==null?void 0:m.control.disabled)}),E=Q.length>0,te=a?g.size>0:!C.isNull(g),se=(()=>{if(!E)return[];const e=C.isUndefined(N==null?void 0:N.filter)?r=>r.label.includes(Q):r=>N.filter(Q,r),t=N==null?void 0:N.sort,i=[],l=r=>{r.forEach(c=>{(!a&&!W||c.isLeaf)&&e(c.origin)&&i.push({label:ae(c),value:c.id,disabled:c.disabled,[v]:c}),c.children&&l(c.children)})};return l(K),t&&i.sort((r,c)=>t(r[v].origin,c[v].origin)),i})(),We=E?se.length===0:K.length===0,[Fe,it]=kt(e=>e.startsWith("Arrow")||["Home","End","Enter","Space"].includes(e)),[ze,He]=n.useState(),ve=(()=>{let e;return ze&&(e=w.get(ze.id),e&&e.enabled)||(te&&(e=ne(K,t=>t.enabled&&t.checked,t=>ee.has(t.id)&&t.children)),C.isUndefined(e)&&(e=ne(K,t=>t.enabled,t=>ee.has(t.id)&&t.children))),e})(),[Se,$e]=n.useState(),ke=(()=>{if(Se&&ne(se,e=>e[v].enabled&&e.value===Se.value))return Se;if(E)return ne(se,e=>e[v].enabled)})(),lt=Et(f),nt=`calc(var(--${T}-zindex-fixed) + ${lt})`,Ee=n.useRef(),j=Ye(()=>{if(f&&U.current&&M.current){const e=U.current.offsetWidth,t=M.current.offsetHeight,i=wt.windowSize.width-Ke*2,l=Math.min(M.current.scrollWidth,i),r=yt(U.current,{width:l,height:t},{placement:"bottom-left",inWindow:Ke});Ee.current=r.transformOrigin,J.classes.position&&M.current.classList.toggle(J.classes.position,!1),J.replaceRule("position",{top:r.top,left:r.left,minWidth:Math.min(e,i),maxWidth:i}),M.current.classList.toggle(J.classes.position,!0)}}),ot=jt(j,!f);Ct(et,"scroll",j,{passive:!0},!f||ot),we(U,j,void 0,!f),we(M,j,void 0,!f),we(tt,j,void 0,!f),n.useImperativeHandle(ue,()=>({updatePosition:j}),[j]);const re=e=>{document.activeElement===Z.current&&e.target!==Z.current&&e.button===0&&e.preventDefault()},ct=e=>{const t=ee.has(e.id);e.origin.loading||(t?Ae(i=>{i.splice(i.findIndex(l=>l===e.id),1)}):(De.current.expands.has(e.id)||(De.current.expands.add(e.id),he==null||he(e.id,e.origin)),Ae(i=>{i.push(e.id)})))},L=n.useRef(),ie=d&&f,Ue=I&&te&&!f&&!S&&!H,Ve=it(n.createElement(d?"input":"div",Object.assign({...oe(p("tree-select__search"),{style:{opacity:ie?void 0:0,zIndex:ie?void 0:-1}}),...m==null?void 0:m.inputAria,ref:st,tabIndex:H?-1:0,role:"combobox","aria-haspopup":"listbox","aria-expanded":f,"aria-controls":be,onBlur:()=>{k(!1)},onKeyDown:e=>{if(e.code==="Escape")f&&qe&&(e.stopPropagation(),e.preventDefault(),k(!1));else{const t=i=>{if(V.current){const l=V.current(i);l&&(E?$e(l):He(l),u===!1&&!i.includes("level")&&(L.current=()=>{const r=document.getElementById(ge(E?l.value:l.id));r&&V.current(r)},f&&(L.current(),L.current=void 0)))}};if(f)switch(e.code){case"ArrowUp":{e.preventDefault(),t("prev");break}case"ArrowDown":{e.preventDefault(),t("next");break}case"ArrowLeft":{E||(e.preventDefault(),t("prev-level"));break}case"ArrowRight":{E||(e.preventDefault(),t("next-level"));break}case"Home":{e.preventDefault(),t("first");break}case"End":{e.preventDefault(),t("last");break}default:{(e.code==="Enter"||e.code==="Space"&&!d)&&(e.preventDefault(),E?ke&&Le(ke):ve&&Me(ve));break}}else if(!(d&&["Home","End","Enter","Space"].includes(e.code)))switch(e.code){case"End":case"ArrowUp":{e.preventDefault(),k(!0),t("last");break}case"Home":case"ArrowDown":{e.preventDefault(),k(!0),t("first");break}case"Enter":case"Space":{e.preventDefault(),k(!0);break}default:{Ut(e.key)&&k(!0);break}}}},onChange:e=>{d&&rt(e.currentTarget.value)}},d?{type:"text",value:Q,autoComplete:"off",disabled:H}:{}))),[at,dt,ut]=(()=>{let e=null,t=null,i;if(a){const l=[];for(const r of X){const c=w.get(r);c&&l.push(c)}t=s.jsx(Rt,{list:l.map(r=>{const{value:c,disabled:O}=r.origin,ft=F?F(r.origin):ae(r);return{id:c,title:ft,type:"item",disabled:O,node:r}}),onClick:(r,c)=>{const O=c.node.changeStatus("UNCHECKED",g);return y(Array.from(O.keys())),!1},children:s.jsx(Ge,{tabIndex:-1,size:xe,children:g.size})}),e=l.map(r=>s.jsxs(Ge,{size:xe,children:[F?F(r.origin):r.origin.label,!(r.disabled||H)&&s.jsx("div",{...p("tree-select__close"),role:"button","aria-label":Ne("Close"),onClick:c=>{c.stopPropagation();const O=r.changeStatus("UNCHECKED",g);y(Array.from(O.keys()))},children:s.jsx(ce,{children:s.jsx(It,{})})})]},r.id))}else if(!C.isNull(g)){const l=w.get(g);l&&(i=ae(l),e=F?F(l.origin):i)}return[e,t,i]})(),pt=Dt({compose:{disabled:H},form:m});return s.jsxs(s.Fragment,{children:[s.jsxs("div",{...b,...oe(p("tree-select",`tree-select--${xe}`,{"tree-select.is-expanded":f,"tree-select.is-disabled":H}),{className:b.className,style:b.style}),...pt,ref:U,onMouseDown:e=>{var t;(t=b.onMouseDown)==null||t.call(b,e),re(e)},onMouseUp:e=>{var t;(t=b.onMouseUp)==null||t.call(b,e),re(e)},onClick:e=>{var t,i;(t=b.onClick)==null||t.call(b,e),(i=Z.current)==null||i.focus({preventScroll:!0}),k(l=>d?!0:!l)},children:[s.jsxs("div",{...p("tree-select__container"),title:ut,children:[Ce?Ce(Ve):Ve,!ie&&(te?s.jsx("div",{...p("tree-select__content"),children:at}):Y?s.jsx("div",{...p("tree-select__placeholder-wrapper"),children:s.jsx("div",{...p("tree-select__placeholder"),children:Y})}):null)]}),a&&s.jsx("div",{...p("tree-select__multiple-count"),onClick:e=>{e.stopPropagation()},children:dt}),Ue&&s.jsx("div",{...p("tree-select__clear"),role:"button","aria-label":Ne("Clear"),onClick:e=>{e.stopPropagation(),me==null||me(),y(a?[]:null)},children:s.jsx(ce,{children:s.jsx(Lt,{})})}),s.jsx("div",{...oe(p("tree-select__icon"),{style:{visibility:Ue?"hidden":void 0}}),children:s.jsx(ce,{children:S?s.jsx(Oe,{}):ie?s.jsx(At,{}):s.jsx(Pt,{...p("tree-select__arrow")})})})]}),s.jsx(Nt,{selector:()=>{let e=document.getElementById(`${T}-tree-select-root`);return e||(e=document.createElement("div"),e.id=`${T}-tree-select-root`,document.body.appendChild(e)),e},children:s.jsx(Tt,{enter:f,during:ye,afterRender:()=>{var e;j(),(e=L.current)==null||e.call(L),L.current=void 0},afterEnter:()=>{z==null||z(!0)},afterLeave:()=>{z==null||z(!1)},children:e=>{let t={};switch(e){case"enter":t={transform:"scaleY(0.7)",opacity:0};break;case"entering":t={transition:["transform","opacity"].map(i=>`${i} ${ye}ms ease-out`).join(", "),transformOrigin:Ee.current};break;case"leaving":t={transform:"scaleY(0.7)",opacity:0,transition:["transform","opacity"].map(i=>`${i} ${ye}ms ease-in`).join(", "),transformOrigin:Ee.current};break;case"leaved":t={display:"none"};break}return s.jsx("div",{...oe(p("tree-select-popup"),{style:{zIndex:nt,...t}}),ref:M,onMouseDown:i=>{re(i)},onMouseUp:i=>{re(i)},children:(()=>{const i=s.jsxs("div",{...p("tree-select-popup__content"),children:[S&&s.jsx("div",{...p("tree-select-popup__loading",{"tree-select-popup__loading--empty":We}),children:s.jsx(ce,{children:s.jsx(Oe,{})})}),S&&We?null:E?s.jsx(Kt,{ref:V,namespace:T,styled:p,id:be,list:se,customItem:je,itemId:ge,itemFocused:ke,multiple:a,onlyLeafSelectable:W,virtual:u,focusVisible:Fe,onClick:l=>{$e(l),Le(l)}}):s.jsx($t,{style:{maxHeight:264,padding:"4px 0"},ref:V,id:be,namespace:T,styled:p,list:K,itemId:ge,itemSelected:!a&&te?w.get(g):void 0,itemFocused:ve,expands:ee,customItem:je,showLine:o,multiple:a,onlyLeafSelectable:W,disabled:!1,virtual:u===!1?void 0:{listSize:264,listPadding:4,itemSize:C.isNumber(u)?u:32},focusVisible:Fe,onNodeFocus:He,onNodeExpand:ct,onNodeClick:Me,onScrollBottom:Xe})]});return Re?Re(i):i})()})}})})]})}const ns=n.forwardRef(Bt);export{ns as T};
