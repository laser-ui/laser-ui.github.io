import{r as g,u as ue,l as h,g as w,j as ie}from"./index-23fad38b.js";import{c as he}from"./Route-170a00e6.js";const b=Symbol();function Se(se,le){const{children:ne,enable:I=!0,list:C,listSize:Y,listPadding:A,itemKey:M,itemRender:U,itemSize:j,itemEmptySize:H=0,itemNested:a,itemEmptyRender:F,itemExpand:P,itemFocusable:V=!0,itemFocused:W,itemInAriaSetsize:B=!0,placeholder:O,horizontal:z=!1,onScrollEnd:q}=ue("VirtualScroll",se),d=h.isNumber(A)?[A,A]:A,R=g.useRef({listCache:new Map}),[oe,re]=g.useState(0),E=g.useMemo(()=>h.isNumber(j)?()=>j:j,[j]),G=g.useMemo(()=>h.isNumber(H)?()=>H:H,[H]),L=g.useMemo(()=>h.isBoolean(V)?()=>V:V,[V]),Q=g.useMemo(()=>h.isBoolean(B)?()=>B:B,[B]),[_,ce,ae,fe]=g.useMemo(()=>{const l=new Map;let c=0,t=0,o,S;if(I){const r=(n,s=0)=>{let e=0;for(const i of n){L(i)&&(S=i,h.isUndefined(o)&&(o=i));const u=M(i),f=E(i);e+=f,c+=f;const x={item:i,level:s,accSize:c,nestedSize:0};l.set(u,x);const p=a==null?void 0:a(i);p&&(!P||P(i))&&(p.length===0?(x.nestedSize=G(i),e+=x.nestedSize,c+=x.nestedSize):(x.nestedSize=r(p,s+1),e+=x.nestedSize))}return e};t=r(C)}else{const r=(n,s=0)=>{for(const e of n){L(e)&&(S=e,h.isUndefined(o)&&(o=e));const i=M(e),u={item:e,level:s,accSize:c,nestedSize:0};l.set(i,u);const f=a==null?void 0:a(e);f&&(!P||P(e))&&f.length>0&&r(f,s+1)}};r(C)}return[l,t,o,S]},[I,G,P,L,M,a,E,C]),de=(()=>{if(I){const l=Math.max(ce+d[0]+d[1]-Y,0),c=Math.min(oe,l);let t=0;const o=c-Y-d[0],S=c+Y*2-d[0];let r=!1,n=!1;const s=(e,i=[])=>{const u=[0,0],f=[],x=e.filter(p=>p===b?!1:Q(p)).length;for(const[p,m]of e.entries()){let v=0,D=0,K,T,J;if(m===b?a!=null&&a(i[i.length-1])&&(v=G(i[i.length-1]),J=ie.jsx(g.Fragment,{children:F==null?void 0:F(i[i.length-1])},"$$empty")):(K=M(m),v=E(m),T=a==null?void 0:a(m),T&&(D=_.get(K).nestedSize)),n){u[1]+=v+D;continue}if(t+=v,T)if(t+D>o){const N=P?P(m):void 0;let $=[];h.isUndefined(N)?$=s(T.length===0?[b]:T,i.concat([m])):($=R.current.listCache.get(K)??[],N&&($=s(T.length===0?[b]:T,i.concat([m])),R.current.listCache.set(K,$))),f.push(U(m,p,{"aria-level":i.length+1,"aria-setsize":x,"aria-posinset":p+1},i,$))}else t+=D,u[0]+=v+D;else r?n||(t>S?(n=!0,u[1]+=v):f.push(m===b?J:U(m,p,{"aria-level":i.length+1,"aria-setsize":x,"aria-posinset":p+1},i))):t>o?(f.push(m===b?J:U(m,p,{"aria-level":i.length+1,"aria-setsize":x,"aria-posinset":p+1},i)),r=!0):u[0]+=v}return u[0]>0&&f.unshift(g.createElement(O,{key:"$$fill-size-0",style:{display:z?"inline-block":"block",overflow:"hidden",width:z?u[0]:0,height:z?0:u[0],flexShrink:0},"aria-hidden":!0})),u[1]>0&&f.push(g.createElement(O,{key:"$$fill-size-1",style:{display:z?"inline-block":"block",overflow:"hidden",width:z?u[1]:0,height:z?0:u[1],flexShrink:0},"aria-hidden":!0})),f};return s(C)}else{const l=(c,t=[])=>{const o=[],S=c.filter(r=>r===b?!1:Q(r)).length;for(const[r,n]of c.entries()){let s,e,i;if(n===b?a!=null&&a(t[t.length-1])&&(i=ie.jsx(g.Fragment,{children:F==null?void 0:F(t[t.length-1])},"$$empty")):(s=M(n),e=a==null?void 0:a(n)),e){const u=P?P(n):void 0;let f=[];h.isUndefined(u)?f=l(e.length===0?[b]:e,t.concat([n])):(f=R.current.listCache.get(s)??[],u&&(f=l(e.length===0?[b]:e,t.concat([n])),R.current.listCache.set(s,f))),o.push(U(n,r,{"aria-level":t.length+1,"aria-setsize":S,"aria-posinset":r+1},t,f))}else o.push(n===b?i:U(n,r,{"aria-level":t.length+1,"aria-setsize":S,"aria-posinset":r+1},t))}return o};return l(C)}})(),k=(l,c)=>{l[z?"scrollLeft":"scrollTop"]=c},X=w((l,c)=>{const t=_.get(c);return I&&!h.isUndefined(t)&&k(l,t.accSize-E(t.item)+d[0]),t==null?void 0:t.item}),Z=w(l=>(I&&k(l,0),ae)),y=w(l=>(I&&k(l,l[z?"scrollWidth":"scrollHeight"]),fe)),ee=w((l,c)=>{if(h.isUndefined(W))return;let t,o,S=-1,r=-1;const n=[];for(const s of _)S+=1,s[0]===W&&(r=S),n.push(s[1]);if(r!==-1)if(c===1)for(let s=r+1,e=0;e<n.length;s++,e++){const i=h.nth(n,s%n.length);if(i&&L(i.item)){t=i.item,I&&(o=[i.accSize-E(t)+d[0],i.accSize+d[0]]);break}}else for(let s=r-1,e=0;e<n.length;s--,e++){const i=h.nth(n,s);if(i&&L(i.item)){t=i.item,I&&(o=[i.accSize-E(t)+d[0],i.accSize+d[0]]);break}}if(!h.isUndefined(o)){const s=l[z?"scrollLeft":"scrollTop"],e=l[z?"clientWidth":"clientHeight"];s>o[1]?k(l,o[0]-d[0]):o[0]>s+e?k(l,o[1]-e+d[0]):c===1?o[1]>s+e&&k(l,o[1]-e+d[0]):s>o[0]&&k(l,o[0]-d[0])}return t}),te=w(l=>{if(h.isUndefined(W))return;let c,t,o=-1,S=-1,r=0;const n=[];for(const s of _)o+=1,s[0]===W&&(S=o,r=s[1].level),n.push(s[1]);if(S!==-1)for(let s=S+1;s<n.length;s++){const e=n[s];if(e.level<=r)return;if(L(e.item)){c=e.item,I&&(t=[e.accSize-E(c)+d[0],e.accSize+d[0]]);break}}if(!h.isUndefined(t)){const s=l[z?"scrollLeft":"scrollTop"],e=l[z?"clientWidth":"clientHeight"];s>t[1]?k(l,t[0]-d[0]):(t[0]>s+e||t[1]>s+e)&&k(l,t[1]-e+d[0])}return c});return g.useImperativeHandle(le,()=>({scrollToItem:X,scrollToStep:ee,scrollToNested:te,scrollToStart:Z,scrollToEnd:y}),[X,ee,te,Z,y]),ne(de,l=>{re(l.currentTarget[z?"scrollLeft":"scrollTop"]),he(l.currentTarget)[z?"x":"y"]&&(q==null||q())})}const me=g.forwardRef(Se);export{me as V};
